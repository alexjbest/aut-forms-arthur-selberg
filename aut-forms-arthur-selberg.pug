section#sec-aut-forms-motivation
    title Automorphic forms #[m / \GL_2] (possibly #[m \GL_n])

    introduction
        aside: p Lecture 1 18/1/2018
        p.
            These are notes for Ali AltuÄŸ's course MA842 at BU Spring 2018, they were last updated #[today/].

        p.
            The course webpage is #[url(href="http://math.bu.edu/people/saaltug/2018_1/2018_1_sem.html")/].
        p.
            Course overview:
            This course will be focused on the two papers #[url(href="http://people.mpim-bonn.mpg.de/zagier/files/scanned/EisensteinSelberg/fulltext.pdf") Eisenstein Series and the Selberg Trace Formula I] by D. Zagier and #[url(href="https://www.math.columbia.edu/~hj/EisensteinTrace.pdf") Eisenstein series and the Selberg Trace Formula II] by H. Jacquet and D. Zagier. Although the titles of the papers sound like one is a prerequisite of the other it actually is not the case, the main difference is the language of the papers (the first is written in classical language whereas the second is written in adelically). We will spend most of our time with the second paper, which is adelic.



    subsection
        title Goal
        p
            | Jacquet and Zagier, Eisenstein series and the Selberg Trace Formula II (1980's).
        p
            | Part I is a paper of Zagier from 1970 in purely classical language.
            | Part II is in adelic language (and somewhat incomplete).
            me \left( \begin{aligned} \amp\text{Arthur-Selberg} \\ \amp\text{trace formula}\end{aligned}\right) \xleftrightarrow{\text{conjecture}} \left( \begin{aligned} \amp\text{Relative} \\ \amp\text{trace formula}\end{aligned}\right)
            | the Arthur-Selberg side is used in Langlands functoriality and the Relative is used in arithmetic applications.

    subsection
        title Motivation
        p
            | What does this paper do?
        blockquote: p: q It rederives the Selberg trace formula for #[m \GL_2] by a regularised process.

        note
            p
                ul
                    li Selberg trace formula only for #[m \GL_2]
                    li Arthur-Selberg more general

        p
            | The Selberg trace formula generalises the more classical Poisson summation formula.

        paragraphs
            title Poisson summation

            theorem#thm-poisson-sum
                title Poisson summation
                statement: p
                    | Let
                    me f\colon \RR \to \RR
                    | then #[term Poisson summation] says
                    me \sum_{n\in \ZZ} f(n) = \sum_{\xi \in \ZZ} \hat f (\xi)
                    | where
                    me \hat f (\xi) = \frac{1}{2\pi} \int_{-\infty}^{\infty} f(x) e(x\xi) \diff x
                    | .

            p
                | Notation: #[m e(x) = e^{2\pi i x}].
            p
                | To make this look more general we make the following notational choices.
                me G = \RR, \Gamma = \ZZ
                me \sum_{\gamma \in \Gamma^\#} f(\gamma) =  \sum_{\xi \in (G/\Gamma)^{\vee}} \hat f(\xi)

                | where
                ul
                    li
                        m \Gamma^\# =
                        |  conjugacy classes of #[m  \Gamma] (#[m = \Gamma] in this case since #[m \Gamma] is abelian).
                    li
                        m (G/\Gamma)^{\vee} =
                        | dual of  #[m G/\Gamma].

        paragraphs
            title Selberg
            p
                me G = \GL_2(\RR),\,\Gamma = \GL_2(\ZZ)
                me \sum_{\gamma \in \Gamma^\#}\cdots ``="  \sum_{\pi\in ``(G/\Gamma)^{\vee}" } \cdots
                | relating conjugacy classes on the left to automorphic forms on the right.

        p
            | Arthur and Selberg prove the trace formula by a #[em sharp cut off], Jacquet and Zagier derive this using a regularisation.

    subsection
        title Motivating example

        p
            me \zeta(s) = \sum_{n=1}^\infty \frac{1}{n^s}
            | converges absolutely for #[m s \gt 1].

        theorem#thm-riemann-zeta-continuation
            title Riemann
            statement: p
                | #[m \zeta(s)] has analytic continuation up to #[m \Re(s) \gt 0] with a simple pole at #[m s=  1] residue #[m 1].
                | i.e.
                me \zeta(s) = \frac{1}{s-1} + \phi(s)
                | where #[m \phi(s)] is holomorphic for #[m \Re(s) \gt 0].
            proof
                title 1
                p
                    | Step 1: observe
                    md
                        mrow \frac{1}{s-1} \amp= \int_1^\infty t^{-s} \diff t \ \text{(for }\Re(s) \gt 1\text{)}
                        mrow  \amp=\sum_{n=1}^\infty \int_{n}^{n+1} t^{-s} \diff t
                p
                    | Step 2: this implies
                    md
                        mrow \zeta(s) \amp= \frac{1}{s-1} + \sum_{n=1}^\infty n^{-s} - \int_{n}^{n+1} t^{-s} \diff t
                        mrow         \amp = \frac{1}{s-1} + \sum_{n=1}^\infty \left(\int_{n}^{n+1} n^{-s} - \int_{n}^{n+1} t^{-s} \diff t\right)
                    | we denote each of the terms in the right hand sum as #[m \phi_n(s)]
                    me \phi_n(s)  = \int_n^{n+1} n^{-s} -t^{-s} \diff t
                p
                    | Step 3:
                    md
                        mrow |\phi_n(s)| \amp\le \sup_{n \le t \le n+1} | n^{-s} - t^{-s}|
                        mrow \amp \sup_{n\le t\le n+1} \frac{|s|}{t^{\Re(s) + 1}}\le \frac{|s|}{n^{\Re(s) + 1}}
                    | by applying the mean value theorem.
                p
                    | So #[m \sum_{n=1}^\infty \phi_n] converges absolutely.
                    | Hence #[m \phi = \sum_{n=1}^\infty \phi_n] is holomorphic
                p
                    | One can push this idea to get analytic continuation to all of #[m \CC], one strip at a time.
                    | This is an analogue of the sharp cut off method mentioned above.
                    | It's fairly elementary but somewhat unmotivated and doesn't give any deep information (like the functional equation).

            proof
                title 2
                p
                    | Introduce
                    me \theta(t) = \sum_{n \in \ZZ} e^{-\pi n^2 t },\,t\gt 0
                    | note that #[m \theta(t)  =  1 + 2 \sum_{n=1}^\infty e^{-\pi n^2 t}].
                p
                    | Idea: Mellin transform and properties of #[m \theta] to derive properties of #[m \zeta].
                    me  \frac{\Gamma\left(\frac{s}{2}\right)}{\pi^{s/2}} \frac{1}{ns} = \int_0^\infty e^{-\pi n^2 t} t^{s/2} \frac{\diff t}{t}
                    | property of #[m \theta]:
                    me \theta(t) = \frac{1}{\sqrt{t}} \theta\left(\frac1t\right)
                p
                    | Step 1: proof of this property is the Poisson summation formula
                    ul
                        li: me f(x) = e^{-\pi x^2} \implies \hat f(\xi) = f(\xi)
                        li: me g(x) = f(\sqrt{t} x) \implies \hat g(\xi) = \frac{1}{\sqrt{t}}\hat f\left(\frac{\xi}{\sqrt{t}}\right)
                p
                    | Step 2: Would like to write something like
                    me `` \int_0^\infty \theta(t) t^{s/2} \frac{\diff t}{t}"
                    | This integral makes no sense
                    ul
                        li
                            | As #[m t \to \infty], #[m \theta \sim 1] thus
                            me \left| \int_A^\infty \theta(t) t^{s/2} \frac{\diff t}{t} \right| \lt \infty
                            me \iff \left| \int_A^\infty t^{s/2} \frac{\diff t}{t} \right| \lt \infty
                            me \iff \Re(s) \lt 0
                        li
                            | As #[m t \to 0] consider #[m \xi = \frac 1t] so #[m \xi \to \infty] and
                            me  \theta(t) = \frac{1}{\sqrt t } \theta\left(\frac 1t\right) = \sqrt \xi \theta \xi]
                            me \implies \theta(t) = \sqrt \xi \theta(\xi) \sim \sqrt \xi = \frac{1}{\sqrt t}
                            | so #[m \theta(t) \sim \frac{1}{ \sqrt t}]
                            me \implies \left | \int_0^A \theta(t) t^{s/2} \frac{\diff t}{t}\right| \lt \infty
                            me \iff \left| \int_0^A t^{(s-1)/2} \frac{\diff t}{t}\right| \lt \infty
                            me \iff \Re(s) \gt 1
                    | so no values of #[m s] will make sense for this improper integral.
                p
                    | Refined idea: Consider
                    me I(s) = \int_0^1 (\theta(t) - \frac{1}{\sqrt t}) t^{s/2} \frac{\diff t}{t} + \int_1^\infty(\theta(t) -  1 ) t^{s/2} \frac{\diff t}{t}
                    | upshot: #[m I(s)] is well-defined and holomorphic for all #[m s\in \CC].
                p
                    | Final step: Compute the above to see
                    me I(s) = \frac2s + \frac{2}{1-s} + \frac{2}{\pi^{s/2}} \Gamma\left(\frac s2\right) \zeta(s)
                    | which implies
                    ol
                        li
                            | #[m \zeta(s)] has analytic continuation to #[m s\in \CC], with only a simple pole at #[m s = 1] with residue 1.
                        li
                            me I(s) = I(1-s)
                            | , this follows from the property of #[m \theta] so if we let
                            me \Lambda(s) = \frac{\Gamma\left(\frac s2\right)}{\pi^{s/2}} \zeta(s)
                            |, then
                            me \Lambda(s) = \Lambda(1-s)
                            | .


    subsection
        title Modular forms

        p
            | Functions on the upper half plane,
            me \HH = \{z\in \CC : \Im(z) \gt 0\}
            | .
        p
            | Historically elliptic integrals lead to elliptic functions, and modular forms and elliptic curves.

        note: p
            | When one is interested in functions on #[m \mathcal O/\Lambda] where #[m \mathcal O] is some object and #[m \Lambda] is some discrete group.
            | Take #[m f] a function on #[m \mathcal O] and average over #[m \Lambda] to get
            me \sum_{\lambda \in \Lambda} f (\lambda z)
            | . If you're lucky this converges, this is good.

        paragraphs
            title Elliptic functions

            p
                | Weierstrass, take #[m \Lambda = \omega_1 \ZZ + \omega_2\ZZ] a lattice an define
                me \wp_\Lambda (z) = \frac{1}{z^2} + \sum_{\omega \in \Lambda \smallsetminus \{0\}} \left( \frac{1}{(z-\omega)^2} + \frac{1}{\omega^2}\right)
                | .
            p
                | Jacobi, (Elliptic integrals) consider
                me \int_0^\phi \frac{\diff t}{\sqrt{(1-t^2)(1-\kappa t^2)}},\ \kappa \ge 0
                | related by:
                me (\wp_\Lambda'(z))^2 = 4 \wp_\Lambda(z)^3 - 60 G_2(\Lambda) \wp_\Lambda(z) - 140 G_3(\Lambda)
                me G_k(\Lambda)  = \sum_{\lambda \in \Lambda\smallsetminus\{0\}} \lambda^{-2k}
                | or
                me G_k(\tau)  = \sum_{(m,n) \in \ZZ^2\smallsetminus\{0\}} \frac{1}{(m\tau+n)^{2k}}
                | the weight #[m 2k] holomorphic Eisenstein series.

            fact: statement: p
                | Let
                me u = \int_y^\infty \frac{\diff s}{\sqrt{4s^3 - 60G_2 s -  140G_3}}
                | then
                me y = \wp_\Lambda (u)
                | .

    subsection
        title Euclidean Harmonic analysis

        introduction
            aside: p Lecture 2 23/1/2018

            p
                | We'll take a roundabout route to automorphic forms.
            p

                | Today:
                | Classical harmonic analysis on #[m \RR^n].
                | Classical harmonic analysis on #[m \HH].
            p
                | The aim (in general) is to express a certain class of functions (i.e. #[m \mathcal L^2]) in terms of building block (harmonics).
            p
                | In classical analysis the harmonics are known (#[m e(nx)]), then the question becomes how these things fit together.
                | In number theory the harmonics are extremely mysterious.
                | We are looking at far more complicated geometries, quotient spaces etc. and arithmetic information comes in.

            example
                statement: p
                    | #[m \RR], #[m f\colon \RR\to \CC], being periodic in #[m \mathcal L^2(S^1)] leads to a fourier expansion
                    me f(x) = \sum_{n\in\ZZ} a_ne(nx)
                    | .

        subsubsection
            title #[m \RR^2]

            p
                | We have a slightly different perspective.
                me \RR^2 = G \acts G
                | via translations (i.e. right regular representation of #[m G] will be #[m G\acts \mathcal L^2(G)]).
                | I.e. #[m g\cdot x = x+g].

            remark
                p
                    | This makes #[m \RR^2] a homogeneous space.
                p
                    | #[m \RR^2] with standard metric #[m \diff s^2 = \diff x^2 + \diff y^2] is a flat space #[m \kappa = 0].

            p
                | To the metric we have the associated Laplacian (Laplace-Beltrami operator, #[m \nabla\cdot\nabla])
                me \Delta = \partder[^2]{x^2}  + \partder[^2]{y^2}
                | we are interested in this as it is essentially the only operator, we will define automorphic forms to be eigenfunctions for this operator.

            note: p
                | The exponential functions
                me \phi_{u,v}(x,y)= e(ux+vy)
                | are eigenfunctions of #[m \Delta] with eigenvalue #[m \lambda_{u,v} = -4\pi^2 (u^2 + v^2)] i.e.
                me (\Delta + \lambda_{u,v}) \phi_{u,v} = 0
                |.
                | These are a complete set of harmonics for #[m \mathcal L^2 (\RR^2)].
                | The proof is via fourier inversion.
                me f(x,y) = \int\int_{\RR^2} \hat f(u,v) \phi_{u,v} (x,y) \diff u\diff v
                | where
                me \hat f(u,v) = \int\int_{\RR^2}     f(u,v) \bar \phi_{u,v} (x,y) \diff y\diff x
                | .

            paragraphs
                title
                    | A little twist
                p
                    | We could have established the spectral resolution ( of #[m \Delta]) by considering invariant integral operators.
                p
                    | Using the spectral theorem if we can find easier to diagonalise operators that commute we can find the eigenspaces for those to cut down the eigenspace.
                p
                    | Recall: an integral operator is
                    me L(f)(x)=       \int K(x,y)f(y) \diff y
                    | invariant means
                    me L(gf) = gL(f) \ g\in G
                    | in our case
                    me g\cdot f(x) = f(g+x)
                    | .


            observation
                p
                    | If #[m L] is invariant then the kernel #[m K(x,y)] is given by
                    me K(x,y) = K_0(x-y)
                    |for some function #[m K_0].
            proof
                proofcase
                    p
                        | #[m (\Leftarrow)] obvious
                proofcase
                    p
                        | #[m (\Rightarrow)] Suppose #[m L] is invariant then
                        me  \int_{\RR^2} K(x,y) f(y+ \alpha) \diff y = \int_{\RR^2} K(x+ \alpha,y) f(y) \diff y \ \forall f
                        | implies
                        me  \int \int_{\RR^2} K(x,y - \alpha) f(y) \diff y = \int_{\RR^2} K(x+ \alpha,y) f(y) \diff y \ \forall f
                        | so
                        me  \int_{\RR^2} (K(x+\alpha,y) - K(x,y - \alpha)) f(y) \diff y = 0 \ \forall f
                        | which implies with some proof that
                        me K(x+\alpha,y) = K(x,y - \alpha)
                        | so
                        me K(x,y) = K(x-y,0)
                        | .


            observation
                p
                    | Invariant integral operators commute with each other
                    me L_1L_2(f)(z) = L_2L_1(f)(z)
            proof: p
                me L_1L_2(f)(z) = \int_{\RR^2 \times \RR^2} f(w) K_2(u-w) K_1(z-u) \diff w \diff u = L_2L_1(f)(z)
                | after change of variables
                me u\mapsto z - u+w

            observation
                p
                    | #[m L] commutes with #[m \Delta].
            proof: p
                | Based on the following:
                me K(x,y) = K_0(x-y,0)
                me \partder[K]{x_i} = - \partder[K]{y_i}
                | which implies
                me \Delta_z(L(f))(z) = \Delta_z \int_{\RR^2} f(w) K(z,w) \diff w
                me = \int\int_{\RR^2} \Delta_z f(w) K(z,w) \diff w
                me = \int\int_{\RR^2} f(w) \Delta_w K(z,w) \diff w
                | which via integration by parts is
                me = \int\int_{\RR^2} \Delta_wf(w)  K(z,w) \diff w = L(\Delta f)(z)
                |.

            observation
                p
                    | #[m \phi_{u,v}(x,y)] is an eigenfunction of #[m L], #[m (u,v)\in\RR^2, (x,y) \in \RR^2].
            proof: p
                me L\phi_{u,v}(\overbrace{z}^{=x,y})  = \int_{\RR^2} \phi_{u,v}(w) K(z,w) \diff w
                me                                   = \int_{\RR^2} \phi_{u,v}(w) K_0(z-w) \diff w
                me                                   = \int_\RR \int_\RR e(uw_1 + vw_2) K_0(z_1- w_1,z_2-w_2)\diff w_1 \diff w_2
                me                                   = e(uw_1 + vw_2)\int_\RR \int_\RR K_0(w_1,w_2)e(-uw_1 - vw_2)\diff w_1 \diff w_2
                | after the change of variable #[m w_i \mapsto - w_i + z_i]
                me \phi_{u,v}(z)\hat K_0(u,v)
                | i.e.
                me L\phi_{u,v} = \hat K_0(u,v) \phi_{u,v}
                | .

            p
                | Side remark: these are enough to form a generating set.

        subsubsection
            title Poisson summation (yet again)

            p
                |Let's consider integral operators on functions on #[m \ZZ^2 \backslash \RR^2 = \mathbf T^2].
            p
                | Observe: #[m L\leadsto K(x,y) = K_0(x-y)].
                me Lf(z) = \int_{\RR^2} f(w) K(z,w) \diff w
                me = \int\int_{\ZZ^2 \backslash \RR^2} f(w) \underbrace{\left(\sum_{n\in\ZZ^2} K(z,w+n)\right)}_{= \sum_{n\in \ZZ} K_0(z-w + n) = \mathbf K(z,w)} \diff w
                | now #[m \mathbf K] is a function on #[m \mathbf T^2 \times \mathbf T^2].
            p
                | Trace of this operator
                me = \int_{\mathbf T^2} \mathbf K(z,z) \diff z = \int_{\mathbf T^2} \left( \sum_{n\in \ZZ^2} K_0(n)\right) \diff z = \sum_{n\in\ZZ^2} K_0(n)

                |  Using sum of eigenvalues
                me K(z,w) = \sum_{n\in \ZZ^2} K_0(z-w + n) = \sum_{\xi \in \ZZ^2} \lambda_\xi \phi_\xi (z-w) = \sum_{\xi\in \ZZ^2} \lambda_\xi \phi_\xi (z) \bar \phi_\xi (w)
                | so the trace is
                me \sum_{\xi \in \ZZ^2} \lambda_\xi = \sum_{\xi\in \ZZ^2} \hat K_0(\xi)
                | so we get to
                me \sum_{n\in \ZZ^2} K_0(n) = \sum_{\xi\in \ZZ^2} \hat K_0(\xi)
                | i.e. Poisson summation.

            p
                | Why care about Poisson summation?
                me \hat K_0(0) = \int K_0(z) \diff z
                | Gauss circle problem, how many lattice points are there in a circle of radius #[m R].
                | We can pick a radially symmetric function that is 1 on the circle and 0 outside, or a smooth approximation of such an indicator function at least.
                | Poisson summation packages the important information into a single term, plus some rapidly decaying ones.
                | Then we get #[m \pi R^2 + ] error, Gauss conjectured that the error is #[m R^{1/2 + \epsilon}].

            aside: p Lecture 3 25/1/2018

            p
                | Last time we gave a conceptual proof of Poisson summation (this strategy will generalise to the trace formula eventually).
            p
                | To clean up one loose end: there is a generalisation of Poisson summation called Voronoi summation, which will actually be useful later.
                | For Poisson summation we had
                me \sum_{n_1,n_2\in \ZZ} K(n_1, n_2) = \sum_{\xi_1,\xi_2\in \ZZ} \hat K(\xi_1, \xi_2)
                | suppose #[m K(x,y)\colon \RR^2 \to \CC] is radially symmetric i.e.
                me K(x,y) = K_0(x^2 + y^2),\,(x,y) \in \RR^2
                | then the fourier transform
                me \hat K(u,v) = \pi\int_0^\infty K_0(r) J_0(\sqrt{\lambda r})\diff r,\,\lambda = 4\pi^2 (u^2 + v^2)
                |  where
                me J_0(z) = \frac1\pi \int_0^\pi \cos(z\cos(\alpha)) \diff \alpha
                |  is a Bessel function of the second kind.

            exercise
                statement: p
                    | Prove this.

            p
                | Plug this into Poisson summation
                me \sum_{(n_1,n_2)\in \ZZ^2} K(n_1,n_2) = \sum_{N=0}^\infty r_2(N)K_0(N)
                | as #[m K] only depends on #[m n_1^2 + n_2^2] we group terms based on this quantity, so
                me r_2 = \#\{(n_1,n_2) \in \ZZ^2 : n_1^2 + n_2^2 = N\}
                | .

            p
                me \sum_{\xi_1,\xi_2\in \ZZ} \pi\int_0^\infty K_0(r) J_0(2\pi \sqrt{(\xi^2_1 + \xi_2^2)r})\diff r
                me = \sum_{M=0}^\infty r_2(M)\tilde K_0(M)
                | .
            theorem
                title Voronoi summation
                statement: p
                    me  \sum_{N=0}^\infty r_2(N)K_0(N) =\sum_{M=0}^\infty r_2(M)\tilde K_0(M)
                    | where
                    me \tilde K_0(z) = \pi\int_0^\infty K_0(r) J_0(2\pi \sqrt{zr})\diff r
                    | .

            p
                | Note that #[m J_0(0) =1 ].

            p
                | How is this useful?
                | Consider point counting in a circle problem.
                | Let #[m K_0(x)] be an approximation to the step function, #[m 1] for #[m x \le 1]  and 0 for #[m x \gt 1].
                | With #[m \int K_0 = 1].
                | Then
                me \sum_{N=0}^\infty K_0\left( \frac{N}{ R^2}\right) r_2(N)
                | . This is counting lattice points.
                | The right hand side is then
                me \sum_{M=0}^\infty r_2(M) \tilde K_0(M) = \tilde K_0(0)  + \sum_{M=1}^\infty r_2(M) \tilde K_0(M)
                me                                        = \pi  + \sum_{M=1}^\infty r_2(M) \tilde K_0(M)
                | . Finally
                me f(z) = K_0\left( \frac{ z}{R^2}\right)
                | so
                me \tilde f(\xi )  = R^2\tilde K_0(\xi R^2)
                | . So
                me \sum_{N=0}^\infty K_0\left( \frac{N}{R^2}\right) r_2(N) = R^2\left( \pi  + \sum_{M=1}^\infty r_2(M) \tilde K_0(MR^2)\right)
                | where the lead term is the area of the circle.
                | Finally if #[m M \ne 0] then #[m f(MR^2)] doesn't increase fast as #[m R\to \infty]. i.e. it is smaller than #[m R^2].
                | So as #[m R\to \infty] we find #[m \#\{\text{lattice points in the circle}\} \sim\pi R^2].



    subsection
        title The hyperbolic plane #[m \HH]

        p
            | What if we consider the same problem on the hyperbolic disk? Things are extremely different.

        paragraphs
            title Generalities

            definition
                statement: p
                    me \HH = \{x+iy:y \gt 0\}
                    | .
                    me \diff s^2 = \frac{1}{y^2} (\diff x^2 + \diff y^2),\,\text{Riemannian metric}
                    | this gives
                    me \kappa=  -1
                    | i.e. this is negatively curved, this is the cause of huge differences between the euclidean theory.

            p
                | There is a formula for the (hyperbolic) distance between two points
                me \rho(z,w) = \log \frac{| z- \bar w| + |z-w|}{| z- \bar w| - |z-w|}
                |.

            observation
                p
                    | As #[m w\to \RR] we have #[m \rho \to \infty].
                    | So #[m \RR] is the boundary.

            p
                | Recall: the isoperimetric inequality
                me 4\pi A -\kappa A^2 \le L^2
                | where #[m L] is the length of the boundary of a region and #[m A] is the area.
                | Note if #[m \kappa = 0] then #[m 4\pi A \le L^2].
                | So #[m A] can be and would be as large as #[m L^2].
            p
                | For #[m \kappa = -1] we have
                me 4\pi A +A^2 \le L^2
                | so #[m A] can at most (and most often will) be as large as #[m \sim L].
                | The upshot is that under the hyperbolic metric, the area and perimeter can be the same size.
                me |\text{Boundary}| \sim |\text{Area}|
                | . Things are a lot more subtle.

            p
                | Another interesting setting is the tree of #[m \PGL_2(\QQ_p)] for #[m p =2] this is a #[m 3]-regular tree.
                | How many points are there of distance less than #[m R] from a fixed point
                me 1 + 3(1+ 2 + \cdots + 2^R) =  1 + 3(2^{R+1} -1 ) \sim 3 \cdot2^{R+1} = 6\cdot 2^R
                | . But how many points of distance exactly #[m R] are there? Roughly #[m 2^R] again.

            p
                | A hyperbolic disk of radius #[m R] centred at #[m i] would be a euclidean disk, but not centered at #[m i].
                | The area is #[m 4\pi(\sinh (R/2))^2] and the circumference is #[m 2\pi\sinh(R)] these are roughly the same size as #[m \sinh(x) = (e^x - e^{-x})/2].
                | The euclidean area is far large (roughly the square) of the hyperbolic.

    subsection
        title #[m \HH] as a homogeneous space

        introduction: p
            me \SL_2(\RR) \acts \HH
            | via linear fractional transformations, i.e.
            me g\cdot z = \frac{az+b}{cz+d} \text{ for } g= \begin{pmatrix} a\amp b \\c\amp d\end{pmatrix} \in \SL_2(\RR)
            | this is the full group of holomorphic isometries of #[m \HH], to get all of them take #[m z\mapsto -\bar z] as well.
            me \HH = \SL_2(\HH) / \SO(2)
            | because #[m \SO(2) = \Stab_i(\SL_2(\RR))].


        subsubsection
            title Several decompositions

            p
                | Cartesian: #[m x+ iy] then the invariant measure is #[m \frac{\diff x\diff y}{y^2}].

            p
                | Iwasawa: #[m G = NAK]
                me N = \left\{ \begin{pmatrix} 1 \amp n \\ \amp 1 \end{pmatrix}:n\in \RR\right\}
                me A = \left\{ \begin{pmatrix} a \amp   \\ \amp a^{-1} \end{pmatrix}:a\in \RR_{\ge 0}\right\}
                me K = \left\{ \begin{pmatrix} \cos \theta \amp \sin \theta  \\ -\sin \theta \amp\cos \theta \end{pmatrix}:\theta\in [0,2\pi)\right\}

                me x+iy \leftrightarrow \underbrace{\begin{pmatrix} \sqrt{y} \amp   \\ \amp \sqrt{y}^{-1} \end{pmatrix}}_A \underbrace{\begin{pmatrix} 1           \amp \frac{x}{\sqrt{y}} \\        \amp      1  \end{pmatrix}}_N
                | this is very general, an analogue of Gram-Schmidt.


            observation
                p
                    me \HH = \underbrace{NA}_{=AN} = \underbrace{P}_{\left\{\begin{pmatrix} * \amp * \\ \amp * \end{pmatrix}\right\}}
                    | warning #[m NA \ne AN] elementwise

            p
                | Cartan: #[m KAK] (useful when dealing with rotationally invariant functions).

            exercise
                statement: p
                    | Prove these decompositions.
                    | Use the spectral theorem of symmetric matrices for the Cartan case.

            paragraphs
                title Classification of Motions

                p
                    |We classify by the number of fixed points in #[m \HH \cup \hat\RR],  for #[m \hat \RR] the extended real line.
                    ul
                        li Identity, infinitely many fixed points.
                        li Parabolic, 1 fixed point in #[m \hat \RR] (#[m \infty]) #[m \begin{pmatrix} 1 \amp n \\ \amp 1 \end{pmatrix}]
                        li Hyperbolic, 2 fixed points in #[m \RR] #[m (0,\infty)],  #[m \begin{pmatrix} a \amp   \\ \amp a^{-1} \end{pmatrix}].
                        li Elliptic, 1 fixed point in #[m \HH] but not in #[m \overline \HH], #[m (i,-i)]  #[m \begin{pmatrix} \cos \theta \amp \sin \theta  \\ -\sin \theta \amp\cos \theta \end{pmatrix}].

                note
                    title for the future

                    p
                        | These notions are different when we consider #[m \gamma \in G(\QQ)] something can be #[m \QQ]-elliptic but #[m \RR]-hyperbolic.
                        | This depends on the Jordan decomposition essentially, we can have such #[m \gamma] with no rational roots of the characteristic polynomial but which splits over #[m \RR].

                p
                    | So we have
                    ul
                        li Parabolic #[m | \tr | = 2]
                        li (#[m \RR]-)Elliptic #[m | \tr | \lt 2]
                        li (#[m \RR]-)Hyperbolic #[m | \tr | \gt 2]


    subsection
        title #[m \Delta_\HH]

        aside: p Lecture 4 30/1/2018

        p
            | For this section #[m \Delta_\HH  = \Delta].

        definition
            statement: p
                | We have the translation operators
                me g\in \SL_2(\RR)
                me T_g f(z) = f(g\cdot z)
                | .


        definition#def-invariant-operator
            title Invariant operators
            statement: p
                | A linear operator #[m L] will be called #[term invariant] if it commutes with #[m T_g] for all #[m g\in \SL_2(\RR)], i.e.
                me L(T_g f) = T_g(Lf)
                | .

        remark
            p
                | On any Riemannian manifold #[m \Delta] can be characterised by:
                | A diffeomorphism is an isometry iff it commutes with #[m \Delta].

        p
            | #[m \Delta] in coordinates:
        p
            |Cartesian
            me \Delta = y^2\left( \partder[^2]{x^2}  + \partder[^2]{y^2}\right) = -(z-\bar z)^2 \partder z \partder{\bar z}
            me \partder z= \frac 12 \left(\partder x - i \partder y\right)
            me \partder{\bar z}= \frac 12 \left(\partder x + i \partder y\right)

        exercise
            statement: p
                | Show that #[m \Delta] is an invariant differential operator.

        p
            | Polar:
            me \Delta = \partder[^2]{r^2}  + \frac{1}{\tanh(r)} \partder{r} + \frac{1}{(2\sinh(r))^2} \partder[^2]{\phi^2}

        p
            | We will be interested in #[m \Delta \acts\cinf(\Gamma \backslash \HH)].

        paragraphs
            title Eigenfunctions of #[m \Delta]

            p
                | This is a little subtle, lets take the definition of an eigenfunction to be
                me f\in C^2( \HH) \text{ s.t. } (\Delta + \lambda) f \equiv 0
                |.

            remark
                p
                    | #[m \Delta] is an #[q elliptic] operator with real analytic coefficients.
                    | This implies any eigenfunction is real analytic.
                    // TODO brian says this is the elliptic regularity theorem, add a reference?

            remark
                p
                    | #[m \lambda = 0] means #[m f] is harmonic.

            p
                | Some basic eigenfunctions:
                | Lets try #[m f(z) = f_0(y)] independent of #[m x]
                me \Delta f = y^{2} \partder[^2]{y^2} f
                | if #[m f] satisfies
                me (\Delta + \lambda)f = 0
                | this implies #[m f] is a linear combination of #[m (y^s,y^{1-s})] where #[m s(1-s) = \lambda] if #[m \lambda \ne \frac 14].
            p
                |If #[m \lambda = \frac 14] this gives #[m y^{1/2}] and #[m \log (y)y^{1/2}].
                | Note the symmetry! #[m s \leftrightarrow 1-s].

            p
                | Let's look at #[m f(z)] depending periodically on #[m x] (with period #[m f]).
                | Separation of variables: try
                me f(z) = e(x) F(2\pi y)
                | where the #[m 2\pi] is really in both factors.
                | This gives
                me \partder[^2]{x^2} f = -4\pi^2 f
                me \partder[^2]{y^2} f = 4\pi^2 e(x) F''(2\pi y)
                | which gives
                me (\Delta + \lambda)f = 0 \iff y^2 4\pi^2 e(x) \left( -F(2\pi y)  + F''(2\pi y)+\lambda F(2\pi y) \right) = 0
                | which implies
                me F''(2 \pi y) + (\lambda - 1) F(2\pi y) = 0
                | this is a close relative of the Bessel differential equation.
                me F''(u) + \left( \frac{\lambda}{u^2} - 1\right) F(u) = 0
                | .
            p
                | This has two solutions
                me \left(\frac{2y}{\pi}\right)^{\frac 12} K_{s-\frac 12}(y) \sim e^{-2\pi y}\text{ as }y\to \infty
                me \left(2y\pi\right)^{\frac 12} I_{s-\frac 12}(y) \sim e^{2\pi y}\text{ as }y\to \infty
                | intuition: as #[m y\to\infty] we have #[m F'' - F = 0] so #[m e^{u}] or #[m e^{-u}].

            remark
                p
                    | If we insist on some #[q moderate growth] (at most polynomial in #[m y]) on the eigenfunction.
                    | The #[m I_{s-\frac 12}] solution can not contribute.
                    | (when we come to automorphic forms we will see that the definition is essentially eigenfunctions with moderate growth).

            p
                | So our periodic (in #[m x]) eigenfunction with (moderate growth) looks like
                me f_s(z) = \underbrace{C2y^{\frac 12} K_{s-\frac12}(2\pi y) e(x)}_{=W_s(z)}
                |.

            definition#def-whittaker
                title Whittaker functions
                statement: p
                    | #[m W_s(z)] is called a #[term Whittaker function].

            p
                | These exist for arbitrary lie groups, but we may not always be able to write eigenfunctions in terms of them in general though.
                | They are a replacement for the exponential functions.

            theorem
                title Spectral decomposition
                statement: p
                    me f(z) = \frac{1}{2\pi i} \int_{\frac 12}\int_\RR W_s(rz) f_s(r) \gamma_s(r) \diff s \diff r,\,s = \frac 12 + it
                    | where
                    me f_s(r) = \int_{\HH} f(z) W_s(rz) \diff z
                    me \gamma_s(r) = \frac{1}{2\pi |r|} t \sinh(\pi t)
                    | analogue of the Fourier inversion formula for #[m \HH].

            theorem#thm-whittaker-expansion
                title 2
                statement: p
                    | If #[m f] is actually periodic in #[m x] and #[m (\Delta + s(1-s)) f= 0] with growth #[m O(e^2{\pi y})]
                    me f(z) =  f_0(y) + \sum_{n=1}^\infty  f_n W_s(nz)
                    | where #[m f_0(y)] is a combination of #[m y^s, y^{1-s}].

            note
                p
                    | We will be considering automorphic forms
                    me \left\langle  \begin{pmatrix} 1 \amp n \\ \amp 1 \end{pmatrix}\right \rangle \subseteq \Gamma \subseteq \SL_2(\ZZ)
                    |.

    subsection
        title Integral operators

        p
            | Recall the Cauchy integral formula for holomorphic functions
            me f(z) = \frac{1}{2\pi i} \int_{B_z} \frac{f(w)}{w-z} \diff w = \int_{B_z} K(w,z) f(w) \diff w
            | i.e. using an integral kernel, #[m f] is an eigenfunction for this operator.

        p
            | Recall: #[m L] is an integral operator if
            me Lf(z) = \int_{\HH} K(z,w) f(w)\diff \underbrace{\mu(w)}_\frac{\diff u\diff v}{v^2} ,\,w = u+iv
            | #[m K] will often be smooth of compact support for us.
            | #[m L] is invariant if it commutes with #[m T_g] for all #[m g].

        observation
            p
                | #[m L] is invariant iff
                me K(gz,gw) = K(z,w)\,\forall g\in \SL_2(\RR)
                | .

        exercise
            statement: p
                | Show this.

        definition#def-point-pair-invariant
            title Point pair invariants
            statement: p
                | A function #[m K\colon \HH \times \HH \to \CC] that satisfies #[m K(gz, g w) = K(z,w)] is called a #[term point pair invariant].
                | This was first introduced by Selberg.

        p
            | Invariant integral operators are convolution operators.


        remark
            p

                | A point pair invariant #[m K(z,w)] depends only of the distance between #[m z,w] i.e.
                me K(z,w) = K_0(\rho(z,w))\text{ for } K_0\colon \RR^+ \to \CC
                | so an invariant operator is just a convolution operator.

        aside: p Lecture 5 1/2/2018

        theorem
            statement
                p
                    | If #[m (\Delta + \lambda)f \equiv 0] and #[m L] is an invariant integral operator.
                    | (#[m \Rightarrow]) Then there exists
                    me \Lambda(\lambda,K)

                    | such that
                    me L(f)(z) = \Lambda(\lambda, K) f(z)
                    | .
                p
                    |(#[m \Leftarrow])  Moreover if #[m f] is an eigenfunction of all invariant operators then #[m f] is an eigenfunction of #[m \Delta].
            proof
                proofcase
                    p
                        | (#[m \Leftarrow]) Let #[m L_K] be
                        me L_K(f)(z) = \int_\HH f(w) K(z,w) \diff \mu (z)
                        | then
                        me L_K(f)(z) = \Lambda_K f(z)
                        | (if #[m \Lambda_K = 0] for all #[m K] then #[m f \equiv 0]).
                        | So that
                        me \Delta f(z) = \Delta \frac{1}{\Lambda_K} L_K f(z)
                        me \frac{1}{ \Lambda_K} \int_\HH f(w) \Delta_z K(w,z) \diff \mu(w)
                    p
                        | Note #[m f \to \int_\HH f(z) \Delta_z K(w,z) \diff \mu(w)] is another invariant integral operator (exercise, show this).
                proofcase
                    p
                        | We will prove an integral representation that looks like the Cauchy integral formula
                        me f(z) = \frac{1}{2\pi i} \int_{B_z} \frac{f(w)}{w-z} \diff w
                        | . Let for #[m w\in \HH],
                        me \Phi_w(f)(z) = \int_{G_w} f(gz) \diff\mu(g)
                        |where #[m G_w] is the stabiliser of #[m w] in #[m \SL_2(\RR)] and #[m \diff\mu] is normalized so that #[m G_w] has volume 1.
                    p
                        | Facts:
                        ol
                            li
                                | If #[m f] is an eigenfunction of #[m \Delta] with eigenvalue #[m (\Delta + \lambda)f \equiv 0], #[m \lambda = s(1-s)]
                                | then there exists a unique function #[m W(z,w)] s.t.
                                me \Phi_w(f)(z) = W(z,w) f(w)
                                me W(w,w) = 1
                                me (\Delta_z + \lambda)W(z,w) \equiv 0
                                me W \text{ is point pair invariant}
                                | .
                            li
                                me L(\Phi_z(f)(z) = L(f)(z)
                                | as
                                me L(\Phi_z(f))(z) = \int_\HH \Phi_z(f) (w) K(w,z) \diff \mu(w)
                                me \int_\HH \int_{B_z} f(gw) \diff \mu(g) K(w,z) \diff \mu(w)
                                me \int_{B_z} \int_\HH f(w)  \underbrace{K(g\inv w,z)}_{=K(w,gz) = K(w,z)} \diff \mu(w)\diff \mu(g)
                    p
                        | Now returning to the proof.
                        | Let #[m (\Delta + \lambda)f  \equiv 0], #[m L] invariant.
                        me Lf(z) = L(\Phi_zf)(z)
                        me = \int_\HH \Phi_z(f) (w) K(z,w) \diff \mu(w)
                        me = \int_\HH W(w,z) f(w) K(z,w) \diff \mu(w)
                        me =\left\{\int_\HH W(w,z) K(z,w) \diff \mu(w)\right\} f(z)
                    p
                        | Claim: #[m \{\cdots\}] depends only on #[m K] and #[m \lambda] not #[m z].
                        | Proof: Let #[m z_1,z_2 \in \HH] and pick #[m g\in \SL_2(\RR)] #[m gz_1 = z_2].
                        me \int_\HH W(w,z_2)K(z_2, w) \diff \mu(w)
                        me = \int_\HH W(w,gz_1) K(gz_1,w) \diff \mu(w)
                        me = \int_\HH W(g^{-1} w,z_1) K(z_1,g\inv w) \diff \mu(w)
                        me = \int_\HH W( w,z_1) K(z_1, w) \diff \mu(w)
                        |.

        p
            | Upshot so far: Poisson summation is a duality, but it can be seen as an equality of the trace of an operator calculated in two different ways.
            | In the non-euclidean setting we can do something similar, but not so recognisable.

        paragraphs
            title Digression: Ramanujan conjecture
            p
                | A weight #[m k] cusp form, eigenfunction of the Hecke operators implies
                me |\lambda_p| \le 2 p^{\frac{k-1}{2}}
                | , #[q correct] normalisation is #[m |\tilde \lambda_p| \le 2].
            p
                | This is about the components at #[m p] but there is also a component at infinity.
            p
                | Selberg's eigenvalue conjecture:
                | #[m \phi] is a cuspidal automorphic (Maass) form with eigenvalue #[m \lambda = s(1-s)] implies #[m s = \frac 12 + it], #[m t\in \RR] i.e. #[m |\lambda| \ge \frac 14].
                // TODO this is like twisting by canonical bundle in Serre duality.
        paragraphs
            title Back to #[m \HH]

            p
                | If we have #[m (\Delta + \lambda) f = 0] can we say anything about #[m \lambda]?

            proposition
                statement
                    p
                        me \lambda\in \RR,\,\lambda\ge 0
                proof
                    p
                        | Introduce the Petersson inner product
                        me \pair FG  = \int_\HH F(z) \overline{G(z)} \diff \mu(z)
                        | . Now
                        me \pair{-\Delta F}{G} = \int_\HH \nabla F \cdot \overline{\nabla G} \diff x\diff y
                        me (\Delta F= \nabla\cdot \nabla F)
                        | exercise: check this.
                        | So #[m \pair {-\Delta F}{G} = \pair {F}{-\Delta G}] which gives #[m \lambda \in \RR].
                        me \pair{-\Delta F}{F} \ge 0 \implies \lambda \ge 0
                        | .

            p
                | For the #[m \frac14] bound one needs to work a little harder.
            proposition
                statement: p
                    me (\Delta + \lambda) \equiv 0 \implies \lambda \ge \frac 14
                    |.
                proof
                    p
                        | Let #[m D\subseteq \HH] be a (nice) domain.
                        | Consider the Dirichlet problem
                        me (\Delta + \lambda)f \equiv 0 \text{ inside }D
                        me f \equiv 0 \text{ on }\partial D
                        |.
                    p
                        | Define
                        me \pair FG _D= \int_D F(z) \overline{G(z)} \diff \mu(z)
                        |. Then
                        me \pair{-\Delta F}{G}_D = \int \nabla F \cdot \overline{\nabla G} \diff x\diff y
                        | (exercise, show this).
                    p
                        men \lambda\|F\|^2 = \pair{-\Delta F}{F} = \int_D \left(\left(\partder[F]{x}\right)^2 + \left(\partder[F]{y}\right)^2\right) \frac{\diff x\diff y}{y^2} \ge \int_D \left(\partder[F]{y}\right)^2\diff x\diff y
                    p
                        | For every fixed #[m x]:
                        me \int F^2 \frac{\diff y}{y^2} = 2 \int F\partder[F]{y} \frac{\diff y}{y}
                        me \implies \int_D F^2 \frac{\diff x \diff y}{y^2}  = 2\int F\partder[F]{y} \frac{\diff x \diff y}{y}
                        | .
                        me \implies  2\int \left| \frac Fy \partder[F]{y}\right | \diff x \diff y \le 2\left( \int \frac{F^2}{y^2} \diff x\diff y\right)^{\frac 12} \left(\int \left(\partder[F]{y}\right)^2 \diff x \diff y\right)^\frac12
                        men \implies \frac12\int_D \frac{F^2}{y^2} \diff x \diff y \le \left( \int \frac{F^2}{y^2} \diff x\diff y\right)^{\frac 12} \left(\int \left(\partder[F]{y}\right)^2 \diff x \diff y\right)^\frac12
                        // TODO
                        | previous two imply
                        me \frac{1}{4\lambda} \int_D \left(\partder[F]{y}\right)^2 \diff x \diff y \le \frac 14 \int_D \frac{F^2}{y^2} \diff x \diff y \le \int_D \left(\partder[F]{y}\right)^2 \diff x\diff y
                        me \frac{1}{4\lambda}\le 1 \implies \lambda \ge \frac 14
                        |.

            remark
                p
                    | In #[xref(ref="thm-whittaker-expansion")/] we restricted to the #[m 1/2] line, this is a reincarnation of #[m \lambda \ge \frac 14].
                    | Only certain functions contributed, similar to the way only the unitaries #[m e^{2\pi ix\xi}] contribute to a fourier expansion, not all characters of #[m \RR].

            p
                | The spectrum of #[m \Delta] on #[m \HH] has #[m \lambda = s(1-s)], #[m s = \frac 12 + it].
                | If we consider the quotient #[m \Gamma \backslash \HH] there is a possibility for #[m t = t_{\RR} + it_{\CC}] where #[m 0\le  t_\CC \le \frac 12].
                | Selberg's conjecture is that these extra ones don't appear for cusp forms.
                | This is very sensitive to the arithmetic, we need a congruence subgroup for this to be true.


    subsection
        title Automorphic forms
        subsubsection
            title Modular forms
            p
                | These are functions  on #[m \HH] that are very symmetric.
                | We already saw one in the first lecture, #[m \theta(t)] in the proof of #[xref(ref="thm-riemann-zeta-continuation")/].
                | Its not quite, instead it is a #[em half-integral] weight modular form as we involved square roots
                me \theta (t) \leftrightarrow \theta\left(\frac 1t\right)
                |.

            definition#def-arthur-selberg-modular-function
                title Modular functions and forms
                statement: p
                    | A #[term modular function] is some
                    me f\colon \HH \to \CC
                    | with
                    me f\left(\frac{az+b}{cz+d}\right) = (cz+d)^k f(z) \, \forall\begin{pmatrix} a\amp b \\c\amp d\end{pmatrix} \in \SL_2(\ZZ)
                    | where, #[m f] is meromorphic on #[m \HH] including #[m \infty].
                    | It is called a #[term modular form] if it is indeed holomorphic at infinity, this is equivalent to some growth condition.

            definition#def-cusp-form
                title Cusp forms
                statement: p
                    | #[m f] is a #[term cusp form] if
                    me \int_0^1 f(x+z) \diff x = 0\, \forall z
                    | .

            aside: p Lecture 6 6/2/2018

            remark
                p
                    | #[m f] has  a fourier expansion (invariant under #[m x\mapsto x+1]) holomorphic implies
                    me f(z) = \sum_{n=0}^\infty a_n e(nz) \ (e(\alpha) =e^{2\pi i \alpha})
                    | cusp form implies
                    me f(z) = \sum_{n=1}^\infty a_n e(nz)
                    | as cuspidal implies #[m f(z) = O(e^{-2\pi y})] as #[m y \to \infty].
                    | #[m f] not cuspidal implies #[m f(z) = O(y^s)] as #[m y \to \infty].

        subsubsection
            title Examples

            example
                statement: p
                    | Constant functions for #[m k = 0].

            example
                statement: p
                    | Eisenstein series (holomorphic).
                    me G_k(z) = \sum_{(m,n) \in \ZZ^2 \smallsetminus (0,0)} \frac{1}{(mz+n)^{2k}}
                    | . Is this cuspidal?
                    | Answer: No! Why?
                    me G_k(z) = 2\underbrace{\zeta(2k)}_{\ne 0} + \frac{2(2\pi i)^{2k}}{(2k-1)!}\sum_{\alpha = 1}^\infty \underbrace{\sigma_{2k-1}(\alpha)}_{=\sum_{d|\alpha} d^{2k-1}} e(\alpha z)
                    | this is of weight #[m 2k]!

            exercise
                statement: p
                    | Prove this.
            example
                statement
                    p
                        me \Delta(z) = (60G_2(z))^3 - 27(140G_3(z))^2
                        | is a cusp form of weight 12.
                    p
                        me \Delta(z) = \sum_{n=1}^\infty a_n e(nz),\,a_n = n^{11/2} \tau(n) \implies \tau(n) = O(n^\varepsilon) \forall \varepsilon
                        me |\tau(p) | \le 2
                        | the original Ramanujan conjecture.

            exercise
                statement: p
                    | Show these.

            example
                title A non-example
                statement: p
                    me j(x) = \frac{1728(60G_2(z))^2}{\Delta(z)}
                    | not holomorphic at #[m \infty].

            example
                statement: p
                    | We had also seen #[m \theta]-function but it #[em does not] fit in to this setting.
                    | It is rather a modular form for a covering group.

            paragraphs
                title Digression: bounds on fourier coefficients of cusp forms

                theorem
                    title Hecke
                    statement
                        p
                            | If #[m f(z)] is a cusp form of weight #[m k]
                            me f(z) = \sum_{n=1}^\infty a_n e(nz)
                            | then
                            me a_n = O( n^{k/2})
                            | called the Hecke or trivial bound.
                        p
                            | If #[m \lambda_n = n^{(1-k)/2} a_n] then this says #[m \lambda_n \le \sqrt n].
                    proof
                        p
                            me f(z) = \sum_{n=1}^\infty a_n e(nz) = e(z) \sum_{n=1}^\infty a_n e((n-1)z)
                            | implies
                            me |f(x) | \le C e^{-2\pi y}
                            | now consider
                            me \phi(z) = f(z) y^{k/2}
                            | . Then
                            me \phi(gz) = \phi(z) \ \forall f\in\SL_2(\ZZ)
                            |(exercise). Moreover #[m \phi(z) \to 0] as #[m y\to\infty] and #[m \phi] is continuous so #[m \exists M] s.t. #[m |\phi(z) | \le M].
                        p
                            | Therefore #[m f(z) \le M y^{-k/2}].
                            me f(z) = \sum_{n=1}^\infty a_n e(nz)
                            me a_n e(iy) = \int_0^1 f(x+iy) e(-nz) \diff x
                            me \le \int_0^1 \frac{M}{y^{k/2}} \diff x = O\left(\frac{1}{y^{k/2}}\right)
                            | for all #[m y] pick #[m y=1/n] so #[m O(n^{k/2})].

        subsubsection
            title Maass forms

            definition#def-maass-form
                title Maass forms
                statement: p
                    | A function #[m f\colon \HH \to \CC] s.t.
                    ul
                        li: me f(gz) = f(z) \ \forall g\in\SL_2(Z)
                        li #[m f] is an eigenfunction of #[m \Delta].
                        li #[m f] is of moderate growth, #[m f(x+iy) = O(y^N)] for some #[m N].
                    | is called a #[term maass form].
                    | If
                    me \int_0^1 f(x+iy)\diff x = 0
                    | we call it a #[term maass cusp form].

            example
                statement: p
                    | Constant functions are Maass forms, this is because they are #[m L^2] because #[m \HH/\SL_2(\ZZ)] has finite volume.

            example
                title Non-holomorphic Eisenstein series.
                statement: p
                    me E(z; s) = \sum_{(c,d) \in \ZZ^2 \smallsetminus (0,0),(c,d) =1,c\ge 0}\frac{\Im(z)^{s+1/2}}{|cz+d|^{2s+1}}
                    |, we choose this normalisation (for now) with #[m s+\frac 12] as it generalises better to #[m \GL_3] which has more elements in its Weyl group.

            aside: p Lecture 7 8/2/2018

            remark
                p
                    | In fact most things are non-holomorphic in the sense that many spaces of interest do not have a complex structure.

            paragraphs
                title Properties
                p
                    ul
                        li
                            me (\Delta + \lambda) E(z; s) = 0
                            me \lambda = \frac 14 - s^2
                        li
                            me E(\gamma z; s) = E(z,s) \ \forall\gamma\in\SL_2(\ZZ)
                        li
                            me E(z; s) = O(y^{\max\{\Res(s+\frac 12),\Re(-s + \frac 12)\}})
                    | hence #[m E(z; s)] is a Maass form.
                    | We have
                    me \Im(\gamma z) = \frac{\Im(z)}{|cz+d|^2}
                    | so
                    me E(z; s) = \sum_{(c,d)\in\ZZ^2 \smallsetminus (0,0), (c,d) =1,c\ge 0} \frac{y^{s+\frac 12}}{|cz+d|^{2s+1}}= \sum_{\gamma \in \pm\Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^{s+\frac12}
                    | where #[m \Gamma_\infty = \left\{ \begin{pmatrix} 1 \amp n \\ \amp 1 \end{pmatrix}\in\SL_2(\ZZ)\right\}].
                    | Exercise: check.
                p
                    me \Delta y^{s+\frac 12} = y^2 (\partder[^2]{x^2}+\partder[^2]{y^2}) y^{s+\frac12}
                    me = (s+\frac12)(s-\frac12) y^{s+\frac12}
                    me = (s^2 - \frac14)y^{s+\frac12}
                    me \implies (\Delta+ (\frac14 - s^2))y^{s+\frac 12} = 0
                    | #[m \gamma] is an isometry implies #[m \Delta\gamma = \gamma\Delta]. So #[m \gamma y^{s+\frac 12}] is also an eigenfunction with eigenvalue #[m \frac 14 - s^2].

                theorem#thm-functional-eqn-eisenstein
                    statement: p
                        | #[m E(z; s)] has analytic continuation to #[m \CC] (in #[m s]), it satisfies #[m E(z; s) = E(z; -s)] and
                        me E(z; s) = O( y^\sigma),\,\sigma=\max\{\Re(s),\Re(-s)\} + \frac 12
                        |.
                    proof
                        p
                            | (Wrong way to prove this) Fourier expansion of Eisenstein series.
                            me E(z; s) = a_0(y)+ \sum_{n\ne 0} a_n 2y^{\frac12}K_s(2\pi |n| y) e(nx)
                            | using #[xref(ref="thm-whittaker-expansion")/].
                            me \int_0^1 E(x+iy ; s ) e(-nx) \diff x = \begin{cases} a_0 (y) \amp n=0 \\ 2a_n y^{\frac 12} K_s(2\pi|n|y) \amp n \ne0 \end{cases}
                            | .
                        p
                            | Note:
                            me E(z; s) = \sum \frac{y^{s+\frac12}}{|cz+d|^{2s+1}}
                            me =\frac12 \frac {1}{\zeta(2s+1)} \sum_{(c,d) \in \ZZ\smallsetminus (0,0)} \frac{y^{s+\frac 12}}{|cz+d|^{2s+1}}
                            | We will work with
                            me E_1(z; s) = \frac {\overbrace{\pi^{-(s+\frac 12)} \Gamma(s+\frac12)}^{\text{for archimidean factors of }\zeta(2s+1)}}{2} \sum_{(c,d) \ne (0,0)} \frac {y^{s+\frac12}}{|cz+d|^{1+2s}}
                            ol
                                li
                                    me.
                                        c= 0 \implies \begin{cases}
                                        \frac {\pi^{-(s+\frac 12)} \Gamma(s+\frac12)}{2}\zeta(1+2s)\amp\text{ if }n=0\\
                                        0                                                          \amp\text{ if }n\ne0
                                        \end{cases}
                                li: p
                                    me c\ne 0 : \sum_{(c,d),\,c\ne0} \int_0^1 \frac{y^{s+\frac12}}{|cz+d|^{2y+1}}  e(-nx) \diff x
                                    me =2 \sum_{c=1}^\infty \sum_{d = -\infty}^ \infty y^{s+\frac 12} \int_0^1 \frac{e(-nx)}{\underbrace{|cz+d|^{2s+1}}_{=cx+d +icy}} \diff x
                                    | the right hand side is invariant under #[m x\mapsto x+1] we can absorb the shift into the sum over #[m d], in a general context this is known as unfolding.

                                    me =2 \sum_{c=1}^\infty\sum_{\alpha \pmod c} \sum_{d \equiv \alpha \pmod c} y^{s+\frac 12} \int_0^1 \frac{e(-nx)}{|cz+d|^{2s+1}} \diff x
                                    me =2 \sum_{c=1}^\infty\sum_{\alpha \pmod c} \sum_{k \in \ZZ}y^{s+\frac 12} \int_0^1 \frac{e(-nx)}{|cx+ck + \alpha + icy|^{2s+1}} \diff x
                                    me =2 y^{s+\frac 12} \sum_{c=1}^\infty\sum_{\alpha \pmod c} \int_{-\infty}^\infty \frac{e(-nx)}{|cx+ \alpha + icy|^{2s+1}} \diff x
                                    me =2 y^{s+\frac 12} \sum_{c=1,\alpha\pmod c}^\infty \frac{e(n\alpha/c)}{c^{2s+1}}\int_0^1 \frac{e(-nx)}{|x+iy|^{2s+1}} \diff x
                                    | note:
                                    me \sum_{\alpha \pmod c} e(n\alpha/c) = \begin{cases} c\amp\text{ if }c|n \\0\amp\text{ if }c\nmid n \end{cases}
                                    | so we get
                                    me 2y^{s+\frac12} \sum_{c=1}^\infty \frac{1}{c^{2s}} \int_{-\infty}^\infty \frac{e(-nx)}{|x+iy|^{2s+1}} \diff x
                                    | two cases
                                    ol
                                        li
                                            | #[m n = 0]
                                            me 2y^{s+\frac12} \sum_{c=1}^\infty \frac{1}{c^{2s}} \int_{-\infty}^\infty \frac{1}{|x+iy|^{2s+1}} \diff x
                                            | #[m x\to yx]
                                            me =2\frac{y^{s+\frac32}}{y^{2s+1}} \sum_{c=1}^\infty \frac{1}{c^{2s}} \int_{-\infty}^\infty \frac{1}{(x^{2}+1)^{\frac{2s+1}{2}}} \diff x
                                            me =2y^{-s+\frac12} \zeta(2s)\int_{-\infty}^\infty \frac{1}{(x^{2}+1)^{\frac{2s+1}{2}}} \diff x
                                        li
                                            | #[m n \ne 0]
                                            me 2y^{s+\frac12} \sigma_{-2s}(|n|)\int_{-\infty}^\infty \frac{e(-nx)}{|x+iy|^{2s+1}} \diff x
                                            | fact:
                                            me \pi^{-(s+\frac 12)} y^{s+\frac 12} \Gamma(s+\frac 12) \int_{-\infty}^\infty \frac{e(-nx)}{|x+iy|^{2s+1} }\diff x = \begin{cases} \pi^{-s} \Gamma (s) y^{\frac12 - s } \amp \text{ if } n = 0 \\ 2|n|^2 \sqrt y K_s(2\pi |n| y) \amp\text{ if } n \ne 0\end{cases}
                                    | Combining these we have shown
                                    men E_1(z; s) = \pi^{-(s+\frac12)} \Gamma(s+\frac 12) \zeta(2s+1 ) y^{s+\frac 12} + \pi ^{-s} \Gamma(s) \zeta(2s) y^{\frac 12 -s} + \sum_{n \ne 0} \sigma_{-2s} (|n|) |n| ^s \sqrt{y} K_s( 2\pi |n| y) e(nx)
                                    | where we have #[m K_s = K_{-s}] and
                                    me \sigma_{-2s} |n|^s = \sum_{d|n} d^{-2s}|n|^s = \sum_{d|n} \frac{d^{2s}}{|n|^s} = |n|^{-s} \sigma_{2s}(|n|) = E(z; s)
                                    | . So we have proved the functional equation and analytic continuation.

            p
                | We can see that we have #[m \zeta] appearing here in the constant term, we can determine analytic information about it using what we know about Eisenstein series, this idea in generality is known as the Langlands-Shahidi method.

            remark
                p
                    | This has poles at #[m s = \frac12], #[m \Res_{s=\frac12} E(z; s) = \frac12].
                    | Note that this residue is constant.
                    | We will use this in Rankin-Selberg.

            aside: p Lecture 8 15/2/2018

            remark: p
                | If #[m G] is a reductive group and #[m M \subseteq G] a Levi subgroup, e.g. for #[m \GL_n] a Levi is diagonal blocks of size #[m n_1 + n_2 + \cdots +n_k = n].
                | One can associate  a cusp form to these subgroups following Eisenstein.
                | There are automorphic #[m L]-functions corresponding to these and by doing the same procedure as last time we see these #[m L]-functions appearing in the constant terms of the Eisenstein series.
                | So we can establish analytic properties of these automorphic #[m L]-functions via those of the Eisenstein series.
                | This is known as the Langlands-Shahidi  method, it only works in some cases but when it does it is very powerful.
                | Shahidi pushed the idea by looking at non-constant terms.
                | In the example above we have
                me \sigma_{-2s}(n) = \sum_{d|n} d^{-2s} \prod(1+ 1/p^{2s} = \prod_{p|n} \zeta_p^{-1}(2s)
                | so there are #[m L]-functions even in the non-constant terms.

        subsubsection
            title Hecke Operators

            p
                | The natural setting to view these is over #[m \GL_2(\QQ_p)].
                | But as we haven't done this yet we will take the path that Hecke took and just write a formula.
                | They act on the space of modular forms.

            definition
                title Slash operators
                statement: p
                    | Let #[m k\in   \ZZ_+] fixed, #[m \gamma \in \GL_2^+(\RR)] (positive determinant).
                    me f|_{\gamma} (z)  = \det(\gamma)^{k/2} (cz+d)^{-k} f\left(\frac{az+b}{cz+d}\right)
                    | . There is a determinant twist so that the center acts trivially.

            definition
                title #[m T_{\gamma}]
                statement: p
                    | Let #[m \gamma\in  \GL_2^+(\QQ)] write
                    me \SL_2(\ZZ) \gamma\SL_2(\ZZ) = \bigsqcup_{i=1}^r \SL_2(\ZZ) \gamma_i
                    | then
                    me T_\gamma(f) =  \sum_{i=1}^r f|_{\gamma_i}(z)
                    | .

            exercise: statement: p
                me \gamma = \begin{pmatrix}p\amp 0 \\ 0 \amp 1 \end{pmatrix}
                me \SL_2(\ZZ)\begin{pmatrix}p\amp 0 \\ 0 \amp 1 \end{pmatrix} \SL_2(\ZZ) = \bigsqcup_{b \pmod p} \SL_2(\ZZ) \begin{pmatrix}1\amp b \\ 0 \amp p \end{pmatrix} \bigsqcup \SL_2(\ZZ) \begin{pmatrix}p\amp 0 \\ 0 \amp 1 \end{pmatrix}
                | .

            paragraphs
                title More classically

                p
                    me T_p(f)(z) = p^{-k/2} \sum_{b\pmod p} f\left(\frac{ z+b}{p}\right) + p^{k/2} f(pz)
                    | . This differs by a normalization of #[m \det] won't change too much but will shift the spectrum.
                    | Or more generally we have
                    me T_n(f)(z) = \sum_{ad = n,\,b\pmod {d} } n^{k/2} d^{-k} f\left(\frac{az+ b}{d}\right)
                    | .

                fact: statement: p
                    | Hecke operators commpute with each other (follows from #[m KAK] decomposition).

                fact: statement: p
                    | Hecke operators are self-adjoint with respect to the Petersson inner product on #[m M_k(1)], the modular forms of weight #[m k] and level #[m 1].
                    me \pair fg_\Pet \int_{\SL_2(\ZZ) \backslash \HH} f(z) \overline{g(z)} y^{k} \diff \mu(z)
                    | .

                lemma
                    statement: p
                        | Let #[m f(z)\ne 0] be  a cusp form of weight #[m k] which is an eigenfunction for all of the Hecke operators with eigenvalue #[m n^{1-k/2} \lambda(n)] i.e.
                        me T_n(f)(z) n^{1-k/2} \lambda(n) f(z) \forall n
                        | let
                        me f(z) = \sum_{n=1}^\infty a_n e(nz)
                        | be its fourier expansion and
                        me L(s,f) = \sum_{n=1}^\infty \frac{a_n}{n^s}
                        | . Then
                        ol
                            li: me a_1 \ne 0
                            li
                                | If #[m a_1  =1] then #[m a_n = \lambda(n) \forall n].
                            li
                                | If #[m a_1 = 1] then #[m \lambda(mn) = \lambda(m)\lambda(n)] for all #[m (m,n) = 1].
                            li
                                | If #[m a_1 = 1] then
                                me L(s,f) = \prod_p(1-a_pp^{-s} + p^{k - 1- 2s})^{-1}
                                | .
                    proof
                        p
                            | By the Fourier expansion
                            me T_nf(z) = \sum_{ad= n,\, b\pmod d} \left(\frac ad\right)^{k/2} f \left( \frac{az+b}{d} \right)
                            me         = \sum_{ad= n,\, b\pmod d} \left(\frac ad\right)^{k/2} \sum_{m=1}^\infty a_m  e\left( \frac{maz}{d} \right) e\left( \frac{mb}{d} \right)
                            me         = \sum_{ad= n,\, b\pmod d} \left(\frac ad\right)^{k/2} d \sum_{m=1}^\infty a_{md}  e\left( maz\right)
                            | .
                            | Which implies
                            me  n^{1-k/2} \lambda(n) f(z) = \sum_{ad= n} \left( \frac ad \right)^{k/2} d \sum_{m=1}^\infty e(maz)
                            | so
                            me  n^{1-k/2} \lambda(n) a_m = \sum_{ad= n,\, a|m} \left( \frac ad \right)^{k/2} d  \frac{a_{md}}{a}
                            | exercise: check.
                            | Take #[m m = 1] so
                            me n^{1-k/2} \lambda(n) a_1 = n^{-k/2 + 1} a_n
                            | hence
                            me \lambda(n) a_1 = a_n
                            | .
                            ol
                                li
                                    | If #[m a_1 = 0] then #[m f \equiv 0].
                                li
                                    | If #[m a_1 = 1] then #[m \lambda(n) = a_n].
                                li
                                    | Follows from 4.
                                li
                                    | Note
                                    me (p^r)^{1-k/2} \lambda(p^r) \lambda(p) = \sum_{ad = p^r,\, a|p} \lambda\left(\frac{pd}{a} \right) \left( \frac ad\right)^{k/2} d
                                    me = \lambda(p^{r+1}) (p^r)^{1-k/2} + \lambda(p^{r-1}) (p^r)^{1-k/2} p^{k-1}
                                    me \left(\sum_{r=0}^\infty \frac{\lambda(p^r)}{p^{rs}}\right) (1-\frac{\lambda(p)}{p^s} + \frac{p^{k-1}}{p^{2s}}) = 1
                                    | .

                p
                    | This is very special to #[m \GL_2], in general fourier coefficients have more information than Hecke eigenvalues.

                remark
                    p
                        | With the normalisation
                        me T_n(f)(z) = \lambda(n) n^{1-k/2} f(z)
                        | the Ramanujan conjecture reads #[m \lambda(n) = O(n^{(k-1)/2 + \epsilon})].

                remark
                    p
                        | Having #[m a_1 = 1] is known as being Hecke normalised.

    subsection
        title Rankin-Selberg method

        introduction: p
            | This is a protoype of the integral representation of automorphic #[m L]-functions.

        subsubsection
            title Mellin transforms of automorphic forms and automorphic #[m L]-functions

            p
                | Let
                me \phi(z) = \sum_{n\in \ZZ} a_n(y) e(nx)
                | then
                me a_n(y) = \int_0^1  \phi(z) \overline {e(nx)} \diff x
                |.
            p
                | Notation:
                me \tilde a_n(s) = \int_0^\infty a_n(y) y^2 \diff^* y,\,\diff^* y = \frac{\diff y}{y}
                | converges for #[m \Re(s) \gg 0] if #[m a_n(y) = O(y^{-N})] for all #[m N].

            theorem
                statement
                    p
                        | Let #[m \phi(x+iy) = O(y{-N})] for all #[m N\gt 0] and #[m \phi(z)] is invariant under #[m z\mapsto \gamma z] for #[m \gamma\in \SL_2(\ZZ)].
                        | Then
                        me \int_{\SL_2(\ZZ)\backslash \HH} \phi(z) E(z; s) \diff z
                        me = \pi^{-s} \Gamma(S) \zeta(2s) \tilde a_0 (s-1)
                        | .

            aside: p Lecture 9 22/2/2018

            definition#def-mellin-transform
                title Mellin transforms
                statement: p
                    | Given
                    me f(y) \colon \RR_+ \to\CC
                    | its #[term Mellin transform] is
                    me \hat f (s) = \int_0^\infty f(y) y^s \frac{\diff y}{y},\, f(y) = O(y^{-N})
                    | .
            p
                | If
                me f(y) = g(Q(n) y)
                me \hat f(s) = \int g(Q(n)y)y^s \frac{\diff y } y = \int g(y) \frac{y^s}{Q^s(n)} \frac{\diff y}{y} = \frac{1}{Q(n)^s} \tilde g(y)

            p
                | What is
                me \int_{\SL_2(\ZZ) \backslash \HH} \phi(z) E_3( z; s)\diff \mu(z)
                | ? The Eisenstein series is essentially
                me \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^s
                | we can see the integrating over #[m \SL_2(\ZZ) \backslash \HH] a sum over #[m \Gamma_\infty\backslash \SL_2(\ZZ)] things should cancel to give us an integral over #[m \Gamma_\infty \backslash \HH], a rectangle!
                | So this unfolding should simplify things.


            proposition#prop-unfolding
                statement: p
                    | Let #[m \phi\colon \HH \to \CC] be automorphic with respect to #[m \SL_2(\ZZ)], with fourier expansion
                    me \phi(z) = \sum_{n=-\infty}^\infty a_n(y) e(nx),\,\text{where}\,a_n(y) = \int_0^1 \phi(x+iy) e(-nx) \diff x
                    | .
                    | If #[m \phi(x+iy) = O(y^{-N})] for all #[m N \gt 0].
                    men \int_{\SL_2(\ZZ) \backslash \HH} \phi(z) E_3( z; s)\diff \mu(z) = \pi^{-s} \Gamma(s) \zeta(2s) \tilde a_0(s-1)
                    | where #[m \phi(z) = \sum_{n\in \ZZ} a_n(y) e(nx)].
                proof
                    p
                        | Follow your nose!
                    p
                        | Recall
                        me E_3(z; s) = \frac{\pi^{-s}}{2} \Gamma(s) \zeta(2s) \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^s
                        | .
                    p
                        | Step 1: The integral converges: Writing #[m E] for #[m E_3] we have
                        me E(z; s) = O(y^2 + y^{1-s})
                        | .
                    p
                        | Step 2: Unfold
                        md
                            mrow \frac{\pi^{-s}}{2} \Gamma(s) \zeta(2s) \int_{\SL_2(\ZZ)\backslash \HH} \phi(z) \left( \sum_{\Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^s \right) \diff \mu(z)
                            mrow =\frac{\pi^{-s}}{2} \Gamma(s) \zeta(2s) \int_{\SL_2(\ZZ)\backslash \HH}  \left( \sum_{\Gamma_\infty \backslash \SL_2(\ZZ)}\phi(\gamma z) \Im(\gamma z)^s \right) \diff \mu(z)
                            // TODO when does 2 disappear
                            mrow =\pi^{-s} \Gamma(s) \zeta(2s) \int_{\Gamma_\infty\backslash \HH}  \phi(z) y^s \diff \mu(z)
                            mrow =\pi^{-s} \Gamma(s) \zeta(2s)\int_0^1 \int_{0}^\infty \phi(z) y^s \frac{\diff x \diff y}{y^2}
                            mrow =\pi^{-s} \Gamma(s) \zeta(2s)\int_{0}^\infty a_0(y) y^s \frac{\diff y}{y^2}
                            mrow =\pi^{-s} \Gamma(s) \zeta(2s)\tilde a_0(s-1)
                        | .

            corollary#cor-l-function-functional-eq-eisenstein
                statement: p
                    me \Lambda(s) = \pi^{-s} \Gamma(s) \zeta(2s) \tilde a_0 (s-1)
                    | we showed
                    me \Lambda(s) = \int_{\SL_2(\ZZ) \backslash \HH} \phi(s) E(z; s) \diff \mu (z)
                    | . (So we can find a functional equation and analytic continuation for from the corresponding properties of the Eisenstein series.)
                    ul
                        li #[m \Lambda(s)] has analytic continuation.
                        li #[m \Lambda(s)] has functional equation #[m s\leftrightarrow s-1].
                        li #[m \Lambda(s)] has poles only at #[m s= 0,1].
                        li: me \Res_{s=1} \Lambda(s) = \int_{\SL_2(\ZZ) \backslash \HH} \phi(s) \diff \mu(z)


            p
                | Note that if we use a cusp form for #[m \phi] we get 0 from the integral above, in #[m L^2] the cusp forms and Eisenstein series are orthogonal.
                | Instead we will cook up something interesting from two functions.

        subsubsection
            title Rankin-Selberg #[m L]-functions

            p
                | Let
                me f(z) = \sum_{n=0}^\infty a_ne(nz)
                me g(z) = \sum_{n=0}^\infty b_ne(nz)
                | be holomorphic modular forms of weight #[m k].
            p
                | Assume that at least one of #[m f] or #[m g] is cuspidal.
                | Assume additionally that #[m f,g] are normalised Hecke eigenforms so #[m a(1) = b(1) = 1].


            definition
                statement: p
                    me \phi(z) = f(z) \overline g(z)y^k
                    | .

            note: p
                | #[m \phi(\gamma z) = \phi(z)] for any #[m \gamma \in \SL_2(\ZZ)].
                | #[m \phi] also satisfies the decay condition.

            note#note-exp-phi0
                p
                    | If #[m f = \sum a_n e(nz)], #[m g = \sum b_n e(nz)] then
                    me f(z)\overline g(z)  = \sum_{m-n \ne 0} A_{n-m} e((n-m)z) + \sum_{n\in \ZZ} a_n \overline b_n
                    | so if we were to integrate this from 0 to 1 #[m \diff x] the first term would disappear and we would be left with the second.
                    me \phi_0(y) = \int_0^1 f(z)\overline g(z) \diff xy^k  = \int_0^1\sum_{m-n \ne 0} A_{n-m} e((n-m)z)y^k +\int_0^1 \sum_{n\in \ZZ} a_n \overline b_ny^k
                    me = \sum_{n\in \ZZ} a_n \overline b_ny^k
                    | i.e.
                    me \phi_0(y) = \int_0^1 \phi(x+iy) \diff x = \sum_{n \in \ZZ} a_n(y) \overline b_n(y) y^k e^{-4\pi i ny}
                    |.

            note: p
                me \tilde \phi_0(s) = \int_0^1 \sum_{n=0}^\infty a_n \overline b_n e^{-4 \pi i y} y^{k+s}\frac{\diff y}{y}
                me = \sum_{n=0}^\infty a_n\overline b_n\int_0^\infty e^{-4 \pi i y} y^{k+s}\frac{\diff y}{y}
                me = \frac{1}{(4\pi )^s} \sum_{n=0}^\infty \frac{ a_n\overline b_n}{n^{k+s}}\int_0^\infty  e^{-y} y^{k+s}\frac{\diff y}{y}
                me = \frac{\Gamma(k+s)}{(4\pi)^{k+s}}\underbrace{\sum_{n=1}^\infty\frac{ a_n\overline b_n}{n^{k+s}}}_{L(s+k; f\times \overline g)}
                | this is the Rankin-Selberg #[m L]-function.
                | So by the #[xref(ref="cor-l-function-functional-eq-eisenstein") corollary]; #[m L(s+k; f\times g)] has analytic continuation and functional equation, and poles only at #[m s= 1+k, s=k].


            paragraphs
                title An application
                p
                    | We proved #[m f] cusp form #[m f(z) = \sum  a_ne(nz)] implies #[m a_n = O(n^{k/2})], Ramanujan #[m a_n = O(n^{k-1/2})].
                    | As cusp forms often appear as error terms for counting arguments knowing it gives us many results, tells us we can just count with Eisenstein series.
                    | The averaged version of the Ramanujan conjecture is much easier
                    me \sum_{n\lt X} a_n
                    |.

            aside: p Lecture 10 27/2/2018

            p
                | Recall #[xref(ref="prop-unfolding")/] and moreover that
                me E(z; s) = \pi^{-s} \Gamma(s) \zeta(2s) \frac 12 \sum_{\gamma \in     \Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^s = \pi^{-s } \Gamma(s) \sum_{(m,n) \in \ZZ^2 \smallsetminus (0,0)} \frac{y^s}{|mz+n|^{2s}}
                | , from this and #[xref(ref="note-exp-phi0")/] we conclude.

                me \int_{\SL_2(\ZZ) \backslash \HH} f(z) \overline g(z) y^k E(z; s) \diff \mu (z)
                men#eqn-conclusion-rankin-selberg = \frac{\pi^{-s} \zeta(2s) \Gamma(s) \Gamma(s+ k-1)}{(4\pi)^{2+k-1}} \sum_{n=1}^\infty \frac{a_n \overline b_n}{n^{s+k-1}}
                | #[xref(ref="eqn-conclusion-rankin-selberg")/] has analytic continuation as a function of #[m s] to all #[m s\in \CC].
                | It has at most simple poles with residue at #[m s =1]:
                me \frac 12 \pair{f}{g}_{\Pet}
                | .
            p
                | If we let
                me L(s,f\times \overline g) = \zeta(2(s-k+1)) \sum_{n=1} ^\infty \frac{a_n \overline b_n}{n^s}
                me \Lambda(s,f\times \overline g) = (2\pi)^{-2s} \Gamma(s) \Gamma(s-k+1) L(s,f\times g)
                | so
                me \Lambda(s, f\times \overline g) = \Lambda(2k-1-s, f\times g)
                | this follows from #[xref(ref="thm-functional-eqn-eisenstein")/] #[m E(z; s) = E(s; 1-s)].
                | .
            p
                | #[m \Lambda(s,f\times \overline g)] has analytic continuation to #[m s\in \CC] with poles at most at #[m s=k,\,s=k-1].
                me \Res_{s=k} \Lambda(s,f\times g) =  \frac{1}{2\pi^{k-1}} \pair fg_{\Pet}
                | .
            p
                | This is analogous to when we took the Mellin transform of the theta function.
                | We have obtained some highly nontrivial information above:

            remark: p
                | Given an arbitrary series of the form
                me  L(s) = \sum_{n=1}^\infty \frac{a_n}{n^s},\,|a_n| = O(n^\alpha)
                | will converge for #[m \Re(s) \gt \alpha + 1].
                | As these coefficients often come from point counts, they will in general be polynomial.

            p
                | Recall the Hecke bound
                me f(z) = \sum_{n=1}^\infty a_n e(nz)
                | a cuspidal (Hecke eigen)form of weight #[m k] has #[m a_n = O(n^{k/2})].
                | Ramanujan (Deligne) gives us #[m a_n =O(n^{(k-1)/2})].
                | Hecke implies that #[m a_n\overline b_n = O(n^k)] implies #[m \sum_{n=1}^\infty \frac{a_n\overline b_n}{n^s}] converges for #[m \Re(s) \gt k+1].
                | Deligne implies that #[m a_n\overline b_n = O(n^{k-1})] implies #[m \sum_{n=1}^\infty \frac{a_n\overline b_n}{n^s}] converges for #[m \Re(s) \gt k].
                | But the above already gives us this convergence, highly nontrivial #[m k]!

            remark
                p
                    | If we take #[m f,g] to be normalized Hecke eigenforms.
                    | Let
                    me 1-\frac{a_p}{p^s} + \frac{1}{p^{2s -k +1}} = (1-\frac{\alpha_1}{p^s})(1-\frac{\alpha_2}{p^s})
                    me 1-\frac{b_p}{p^s} + \frac{1}{p^{2s -k +1}} = (1-\frac{\beta_1}{p^s})(1-\frac{\beta_2}{p^s})
                    | then
                    me L(s,f\times \overline g) = \prod_p  \prod_{1\le i,j\le 2}(1- \frac{\alpha_i \overline \beta_j}{p^s})^{-1}
                    | .

            exercise: statement
                p
                    | Prove this.

            paragraphs
                title Applications

                p
                    | If one proves the prime number theorem using non-vanishing of the #[m \zeta] function in a certain region you use a weird identity using sines and cosines being positive.
                    | This really comes from a Rankin-Selberg product.

                remark
                    p
                        | Rankin-Selberg proves positivity.
                        me z\in \ZZ,\,|z|^2 \ge 0
                        | .

                p
                    | Ramanujan on average:
                    me \sum_{n\lt X } a_n  \sim X^{(k+1)/2}
                    | this is equivalent to
                    me L(s) = \sum_{n=1}^\infty \frac{a_n}{n^s}
                    | converges for #[m \Re(s) \gt (k+1)/2].
                    | Let
                    me \phi(z) = \sum_{n=1}^\infty a_n e(nz)
                    | be a cusp form of weight #[m k].
                p
                    |Consider
                    me D(s) = \sum_{n=1}^\infty \frac{|a_n|^2}{n^s}
                    | , Hecke implies this converges for #[m \Re(s) \gt k+1].

                note
                    p
                        me D(s) = L(s, f\times \overline f)
                        | converges for #[m \Re(s) \gt k].

                p
                    | Now observe that for any #[m \lambda \gt 0]
                    me |a_n| \le \max \left\{n^\lambda, \frac{|a_n|^2}{n^\lambda}\right\}
                    | . So
                    me \sum_{n=1}^\infty \frac{|a_n|}{n^s} \le \max\sum_{n=1}^\infty \max \left\{ \frac{1}{n^{s-\lambda}}, \frac{|a_n|}{n^{s+\lambda}}\right\}
                    | choose #[m \lambda = (k-1)/2]
                    | so
                    me \lt \max\sum_{n=1}^\infty \max \left\{ \frac{1}{n^{s-(k-1)/2}}, \frac{|a_n|}{n^{s+(k-1)/2}}\right\}
                    | which converges for #[m s\gt (k+1)/2].

                question
                    statement: p
                        | Fix #[m \diff \mu(z) = \frac{\diff x \diff y}{y^2}] on #[m \HH].
                        | What is #[m \vol(\SL_2(\ZZ) \backslash \HH)]? (#[m \pi/3]?)

                        | What about other #[m \Gamma]?
                p
                    | Naive observation:
                    me \int \frac 12 \diff \mu(z) = \frac{\vol}{2}
                    | and
                    me \frac 12  = \Res_{s=1 } E(z; s)
                    | so
                    me \frac{\vol}{2} = \int_{\SL_2\backslash \HH} \Res_{s=1} E(z; s) \diff \mu(z) ``=" \Res_{s=1} \int_{\SL_2(\ZZ) \backslash \HH} E(z; s) \diff \mu(z)
                    | but the right hand side does not converge (exercise, check).

                p
                    | Problem: naive idea doesn't work #[m \int_{\SL_2(\ZZ)\backslash \HH} E(z; s) \diff \mu(z)] converges only for #[m 0 \lt 1 \lt 1].
                    | but then we can't unfold because the series defining #[m E(z; s)] does not converge #[m 0\lt s \lt 1].
                    | We must target the source of this divergence, the constant term of the Eisenstein series.
                    me \int_1^\infty * y^s + * y^{1-s} \frac{\diff y}{y^2}
                    | we will truncate the Eisenstein series.

        subsubsection
            title Applications
            aside: p Lecture 11 1/3/2018


            p
                | First aim of the day:
                | Calculate
                me \vol(\SL_2(\ZZ)\backslash\HH,\,\diff \mu(z) = \frac{\diff x \diff y}{y^2})

                | Idea:
                | Use the pole of #[m E(z; s)] at #[m s= 1] and unfolding.
                me E(z; s) = \frac{\pi^{-s} \Gamma (s)\zeta(2s)}{2} \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^{s}
                me \Res_{s=1} E(z; s) = \frac 12
                | .
                | Idea:
                me \Res_{s=1} \int_{\SL_2(\ZZ) \backslash \HH} E(z; s)  = \diff \mu(z) =  \frac{\vol}{2}
                | .
                | Problem: Constant term of #[m E(z; s) \sim y^s + y^{1-s}].
                me \int_{1}^\infty y^s + y^{1-s} \frac{\diff y}{y^2}
                | converges only if #[m 0\lt s \lt 1].
                | This approach needs modification, we will look at two such.
                ol
                    li Sharp cut-off,
                    li Smooth cut-off.

            paragraphs
                title 1 Sharp cut-off
                p
                    | For sharp cut off we will fix some #[m T \gt 0] and only consider #[m y\lt T].
                    | Setting
                    me.
                        y_T(z) =
                        \begin{cases}
                        y \amp y\lt T\\
                        0 \amp y\ge T
                        \end{cases}
                    | using this
                    me E_T(z; s) = \frac{\pi^{-s} \Gamma (s)\zeta(2s)}{2} \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} y_T(\gamma z)^{s}
                    | .
                p
                    | Observations:
                lemma
                    statement: p
                        | #[m K \subseteq \HH] compact, there exists #[m T_K] such that for all #[m T \ge T_K]
                        me E_T(z; s) = E(z; s) \,\forall z\in K
                        | .
                    proof: p
                        me \Im(\gamma z) = \frac{y}{|cz+  d| ^2 } = \frac{ y}{((cx+d)^2 + (cy)^2)}
                        me \le \max\left\{ \frac{y}{d^s}, \frac{1}{c^2 y}\right\}
                        me \Im(\SL_2(\ZZ)K) \le T_0
                        | for some #[m T_0].

                lemma
                    statement: p
                        me \int_{\SL_2(\ZZ) \backslash \HH}  E_T(z; s) \diff \mu(z) = \pi^{-s} \Gamma(s) \zeta(2s) \frac{T^{s-1}}{s-1}
                    proof: p
                        | (Unfold), recall
                        me \Gamma_\infty = \left\{ \begin{pmatrix} 1 \amp n \\ \amp 1 \end{pmatrix}\in\SL_2(\ZZ)\right\}
                        | so
                        me \int_{\SL_2(\ZZ) \backslash \HH}  E_T(z; s) \diff \mu(z) = \pi^{-s} \Gamma(s) \zeta(2s) \int_{\SL_2(\ZZ) \backslash \HH}  \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} y_T(\gamma z)^{s} \diff \mu(z)
                        me = \pi^{-s} \Gamma(s) \zeta(2s) \int_{\Gamma_\infty \backslash \HH}   y_T \diff \mu(z)
                        me = \pi^{-s} \Gamma(s) \zeta(2s) \int_0^1\int_0^T   y^{s-1} \diff \mu(z)
                        me = \pi^{-s} \Gamma(s) \zeta(2s) \frac{T^{s-1}}{s-1}
                p
                    | There is a huge generalization of this lemma by Langlands that allows him to calculate a lot of volumes.

                lemma
                    statement: p
                        | Let #[m T \gt 1] and #[m x+ iy] in the standard fundamental domain #[m \mathcal F] for #[m \SL_2(\ZZ) \backslash \HH] then
                        me.
                            E_T(z; s) =
                            \begin{cases}
                            E(z; s) \amp y\lt T\\
                            E(z; s) - pi^{-s} \Gamma(s) \zeta(2s) y^s \amp y\ge T
                            \end{cases}
                        | .
                    proof
                        p
                            | Recall
                            me \Im(\gamma z) = \frac{ y}{((cx+d)^2 + (cy)^2)}
                        p
                            | Case 1:
                            | #[m c \ne 0 ] implies #[m \Im( \gamma z)  \le \frac{1}{c^2 y} \le T] for all #[m y\in \mathcal F].
                        p
                            | Case 2:
                            | #[m c =   0 ] implies #[m \Im( \gamma z) = \frac{y}{d^2 } ]
                            me \gamma = \begin{pmatrix} a \amp b\\ 0 \amp d\end{pmatrix} \in \SL_2(\ZZ)
                            | implies #[m ad = 1] so #[m a= d= 1] or #[m a=d=  -1].
                            me E_T(z; s) = \frac{\pi^{-s} \Gamma (s)\zeta(2s)}{2} \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} y_T(\gamma z)^{s}
                            me  = \frac{\pi^{-s} \Gamma (s)\zeta(2s)}{2} \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} y(\gamma z)^{s}  -  \frac{\pi^{-s} \Gamma (s)\zeta(2s)}{2} \sum_{ d = \pm 1} y_T(\frac{y}{d^s})^{s}
                            me.
                                =
                                \begin{cases}
                                E(z; s)  - \pi^{-s} \Gamma (s)\zeta(2s) y^s \amp y\lt T\\
                                E(z; s) \amp y\ge T
                                \end{cases}
                remark
                    p
                        | #[m E(z; s) - E_T(z; s) ] for fixed #[m z] is holomorphic as a function of #[m s] at #[m s =1].


                theorem
                    statement: p
                        me \vol(\SL_2(\ZZ) \backslash \HH) = \frac\pi 3
                        | .
                    proof: p
                        | #[m E(z; s) - E_T(z; s) ] is holomorphic at #[m s =1].
                        | So
                        me \int_{\SL_2(\ZZ) \backslash \HH} \Res_{s=1}(  E(z; s) - E_T(z; s) ) \diff \mu(z) = 0
                        me \int_{\SL_2(\ZZ) \backslash \HH} \frac 12 -\Res_{s=1}( E_T(z; s) ) \diff \mu(z) = 0
                        me \int_{\SL_2(\ZZ) \backslash \HH} \Res_{s=1}( E_T(z; s) ) \diff \mu(z) = \frac 12 \vol(\SL_2(\ZZ) \backslash \HH)
                        me \Res_{s=1}\int_{\SL_2(\ZZ) \backslash \HH}  E_T(z; s) \diff \mu(z) = \frac 12 \vol(\SL_2(\ZZ) \backslash \HH)
                        me \Res_{s=1}\pi^{-s} \Gamma (s)\zeta(2s) \frac{T^{s-1}}{s-1} = \frac 12 \vol(\SL_2(\ZZ) \backslash \HH)
                        me = \frac 1 \pi \frac{\pi^2}{6}
                        | hence
                        me \vol(\SL_2(\ZZ) \backslash \HH) =  \frac {\pi}{3}
                        | .

                p
                    | Volumes of such domains are known as Tamagawa number and many such were computed via these methods by Langlands in the 60s.

            paragraphs
                title 2 Smooth cut-off

                p
                    | Let #[m f \in \cinf_c(\RR_{\ge 0 })] e.g. some nice bump.
                    | Consider
                    me \theta_f(z ) = \frac 12 \sum_{\Gamma_\infty \backslash \SL_2(\ZZ)} f(\Im(\gamma z))
                    | idea
                    me f(x) = \frac{1}{2\pi i} \int_{(\sigma)} \tilde f(s)  x^{-s} \diff s
                    | for #[m a\lt \sigma\lt b] such that #[m \tilde f = \int_0^\infty y^s f(y) \frac{\diff y}{y}] converges absolutely for #[m a \lt s \lt b].
                    | Observation: #[m \sigma\in \RR] for this to hold.
                    | So
                    me \theta_f(z) = \sum \left( \frac{1}{2\pi i} \int_{(\sigma)} \tilde f(s) \Im(\gamma z)^{-s} \diff s\right)
                    | for #[m \Re(s) \lt -s]:
                    me  = \frac{1}{4\pi i} \int_{(\sigma)} \tilde f ( s) \left(\sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^{-s}\right) \diff s
                    me  = \frac{1}{2\pi i} \int_{(\sigma)} \tilde f ( s) E_1(z; -s) \diff s
                    | where
                    me E_1(z; s) = \frac12 \sum_{\gamma\in \Gamma_\infty \backslash \SL_2(\ZZ)} \Im(\gamma z)^{s}
                    | .
                    | Now integrate
                    me \int_{\SL_2(\ZZ)\backslash \HH} \theta_f(z) \diff \mu (z) =  \int_{\SL_2(\ZZ)\backslash \HH} \frac{1}{2\pi i} \int_{(\sigma)} \tilde f (s) E(z; -1) \diff s\diff \mu(z)
                    me = \tilde f (-1) \left(\Res_{s=1} E_1(z; s)\right) \vol(\SL_2(\ZZ)\backslash \HH)
                    me + \underbrace{\frac{1}{2\pi i} \int_{(-\frac 12)} \tilde f(s) \int_{\SL_2(\ZZ)\backslash \HH} E(z; -s) \diff \mu(z) \diff s}_{=\pair{E(z; s)}{1}_{\Pet}}
                    | (shifting contours to #[m \sigma = \frac{-1}{2} + it]).
                    | The rightmost term is 0 as we have a decomposition
                    me L^2(\SL_2(\ZZ)\backslash \HH)= 1\oplus \int_{(\frac 12)} E(z; s) \diff s \oplus \text{cusp form}
                    | . We'll do this by hand here.
                    | i.e.
                    me \int_{\SL_2(\ZZ)\backslash \HH} \theta_f(z) \diff \mu (z) =\tilde f (-1) \underbrace{\left(\Res_{s=1} E_1(z; s)\right)}_{=3/\pi} \vol(\SL_2(\ZZ)\backslash \HH)
                    me + \int_{\SL_2(\ZZ)\backslash \HH} E(z; -s) \diff \mu(z) \diff s
                    | .
                lemma
                    statement: p
                        me \int_{\SL_2(\ZZ) \backslash\HH} \theta_f(z) \diff \mu (z)  = \tilde f(-1)
                    proof: p
                        | Exercise.

                p
                    | The lemma implies #[m \forall f \in \cinf_c(\RR_{\gt 0})] we have the following
                    men#eqn-volE \tilde f (-1) \left(1-\frac3\pi \vol{}\right) = \frac{1}{2\pi i } \int_{(\frac12)} \tilde f (-s) \int  E(z; -s) \diff \mu(z) \diff s

                claim
                    statement: p
                        | #[xref(ref="eqn-volE")/] implies that
                        me \int_{\SL_2(\ZZ) \backslash \HH} E(z; -s ) \diff \mu(z) \equiv0
                        | , whenever it converges.
                    proof: p
                        | By a change of variables we can rewrite #[xref(ref="eqn-volE")/] as
                        me c \tilde f (-1)= \int_{(0      )} \tilde f (-\frac12+s)I(S)                         \diff s
                        | for some constant #[m c].
                        ol
                            li
                                | Take #[m F(y) = y^{\frac12} f(y)] which implies
                                me  \tilde F(s) = \tilde f( s+ \frac 12)
                                | . #[xref(ref="eqn-volE")/] #[m \iff]
                                me \frac{1}{2\pi i } \int_{(0)} \tilde F(s) I(s) \diff s = c \tilde F(-\frac32)
                                | .
                            li
                                | Trick:
                                | Let #[m G(y) = (y\partder{y} F + \frac32 F)] so
                                me \tilde G(s) = s\tilde F(s) + \frac 32  \tilde F(s)
                                | so
                                me \tilde G(-\frac 32) = 0
                                | implies
                                me \frac{1}{2\pi i} \int \tilde G (-s) I(z; s) \diff s = 0
                                me I(z; s) \equiv 0
                                | whenever it converges.

section#sec-eichler-selberg
    title The Eichler-Selberg trace formula

    subsection
        title The OG approach
        aside: p Lecture 12 15/3/2018
        p
            | What does it do?
            | It calculates the #[em trace] of the #[m m]th Hecke operator #[m T(m)] on #[m S_k] the space of holomorphic modular forms of weight #[m k] level 1.

        p
            | Input #[m m \in \ZZ_{\ge 0}], #[m k] weight.

        remark
            p
                | It is more general, there is an  (Eichler-)Selberg trace formula for general level #[m N].
            p
                | Even more generally there is a Selberg trace formula for Maass forms of arbitrary level.
            p
                | Even more general Arthur-Selberg trace formula for automorphic representations on any group.


        p
            | Recall
            me T(m) f(z) =  m^{k-1} \sum_{ad=m,\, b \pmod d} d^{-k} f\left(\frac {az+b}{d} \right)
            | #[m S_k]  cusp forms of weight #[m k\ge 2] even level 1.
            me \trace_{S_k} T(m) = -\frac12 \sum_{t\in \ZZ,\,t^2 - 4m \lt 0} P_k(t,m) H(4 m -t^2)
            me -\frac12 \sum_{dd' = m} \min(d,d')^{k-1} +\begin{cases} \frac{k-1}{2} m^{k/2 - 1} \amp m\in \ZZ^2 \\ 0 \end{cases}
            | .
            | Where
            me P_k(t,m) = \frac{\rho^k - \bar \rho^k}{\rho - \bar\rho}
            | for #[m \{\rho,\bar \rho\}] solutions to #[m X^2 - tX + m = 0].
            | #[m H(n)] is the #[q Hurwitz class number]
            me = \#\{Q \text{ pos. def. integral quad. form}: \disc Q = -N\}/\SL_2(\ZZ)
            | each one counted with multiplicity 1 unless it is equivalent to #[m x^2+y^2 \to \frac 12], #[m x^2+xy+y^2 \to \frac 13]
            | We will prove this and examine some consequences.
        p
            | How would we calculate terms in this? It can be hard, the Hurwitz class number requires #[m \sqrt D] time for #[m N = f^2D], #[m D] a fundamental discriminant.
            | To get the trace we can integrate #[m \int K(x,x)] for the kernel which gives us #[m T(m)].



        paragraphs
            title Towards the trace formula
            p
                | We will follow Zagier: Modular forms whose coefficients are Dirichlet series.
            p
                | Normalization: Let #[m \{f_1, \ldots, f_r\}] be a basis for #[m S_k].
                | We will assume that they are all Hecke eigenfunctions and they are normalized by #[m a_1^i = 1] (Hecke normalized).
                me f_i(z)  = \sum_{i=1}^\infty a_n^i e(nx)

            note
                p
                    | #[m f_i]s are pairwise orthogonal with respect to #[m \pair{-}{-}_{\Pet}]
                    me \pair{f_i}{f_j}_{\Pet} = \int_{\Gamma\backslash \HH} f_i\bar f_j y^k \frac{\diff x\diff y}{y^2}
                    | why: say #[m a^i_m \ne 0] for some #[m m] then
                    me \pair{f_i}{f_j}_{\Pet} = \frac{1}{a_m^i} \pair{T(m) f_i}{f_j}_\Pet
                    me                              = \frac{1}{a_m^i} \pair{ f_i}{T(m)f_j}_\Pet
                    me                              = \frac{a_m^j}{a_m^i} \pair{ f_i}{f_j}_\Pet

        paragraphs
            title Kernel function

            theorem
                statement: p
                    | #[m T(m)] is an integral operator with the kernel
                    me h_m(z,z') = \sum_{ad-bc = m }\frac{1}{(czz' + dz' + az+ b)^k} = \frac{1}{(cz+d)^k} \frac{1}{z' + \left(\frac{az+b}{cz+d}\right)^k}
                    | .

            note
                p
                    | Let's set #[m j_k(\gamma,z) = (cz+d)^{-k}],
                    me \gamma = \begin{pmatrix} a \amp b\\ c \amp d\end{pmatrix} \in \SL_2(\ZZ)
                    me F_k(z,z') = (z+z')^{-k}
                    | so
                    me h_m(z,z') = \sum_{\gamma\in \Mat_2(\ZZ),\,\det \gamma = m} j_k(\gamma,z) F_k(\gamma z, z')
                    | .
                    | Even more is true #[m h_m(z,z') = h_1(T_m(z), z')].

            proof
                p
                    me f\ast h_m(z') = \frac{c_k}{m^{k-1}} T_m(f)(z')
                    | #[m c_k = (-1)^{k/2} \pi/2^{k-3}(k-1)].
                    | set #[m m = 1] (this is enough because of our earlier observation).
                    me f\ast h_1( z') = \int_{\Gamma \backslash \HH} f(z)  \overline{h_1(z,-\bar z')} y^k \diff \mu(z)
                    me  \int_{\Gamma \backslash\HH} f(z) \left\{ \sum_{\gamma} j_k(\gamma,z) (-z' + \gamma z)^{-k} \right\} y^k \diff \mu(y)
                    | #[m f] is  a modular form of weight #[m k] implies
                    me f(\gamma z) = (cz+d)^k  f(z)
                    me \Im(\gamma z ) = \frac{y}{|cz+d|^2}
                    | so
                    men \overline{(cz+d)^{-k}} f(z) y^k = f(\gamma z) \Im(\gamma z )^k
                    | . this implies
                    me \int_{\Gamma\backslash \HH}     f(\gamma z) \Im('g z)^i (-z' + \overline{\gamma z})^{-k}          \frac{\diff x\diff y}{y^2}
                    me = 2 \int_0^\infty \int_{-\infty}^{\infty} f(z) y^k (-z' + \bar z) ^{-k} \frac{\diff x \diff y}{y^2}
                    | Cauchy integral formula implies
                    me \int_{-\infty}^\infty \frac{f(x+iy)}{(x -iy -z')^k} \diff x
                    me 2 \pi i/(k-1)! f^{(k-1)}(2\pi i y)
                    me 4\pi i /(k-1)! \int _0^\infty f^{(k-1)} (2iy + z') y^{k-2} \diff y
                    | inner part is
                    me 1/(2i)^{k-2} \frac{\diff^{k-2}}{\diff t^{k-2}} f' (2 i ty + z') |_{t=1}
                    me 4 \pi i/(k-1)! 1/(2i)^{k-2}\frac{\diff^{k-2}}{\diff t^{k-2}} \int_0^\infty f'(2ity + z') \diff y |_{t=1}
                    me = -4\pi i /(k-1)!(2i)^{k-1} \frac{\diff^{k-2}}{\diff t^{k-2}} \frac1t f(z')|_{t=1}
                    me = (i/2)^{k-1}4\pi i /(k-1) f(z') = c_kf(z')
                    | .

            corollary
                statement: p
                    me c_k\inv m^{k-1} h_m(z,z') = \sum_{i=1}^r \frac{a^i_m}{\pair{f_i}{f_i}_\Pet} f_i(z)f_i(z')
                    | spectral decomposition.
                    me \trace(T_m) = \frac{c_k\inv}{m^{k-1}} \int_{\Gamma\backslash \HH} h_m(z,\bar z)\Im(z)^k \frac{\diff x \diff y}{y^2}
                    | .
                proof: p
                    | Expand #[m h_m(z,z')] with respect to #[m \{f_1, \ldots, f_r\}].
                    | #[m h_m(z,z')] is a cusp form in both variables, we will show this later!
                    me h_m(z,z') = \sum_{1\le i,j\le r} \alpha_{i,j} f_i(z) f_j(z'),\, \alpha_{i,j} \in \CC
                    | By the theorem
                    me \frac{c\inv_k}{m^{k-1}} f\ast h_m(z') = T_m(f)(z')
                    | let's apply this to #[m f_{i_0}] for any #[m i_0]
                    | .. Next time.

            aside: p Lecture 13 20/3/2018
            p
                | Summary:
            p
                | Aim: to establish the Eichler-Selberg trace formula for  the trace of #[m T_m \acts S_k], for #[m T_m]  the #[m m]th Hecke operator
                me (T_m f )(z ) = m^k \sum_{j=1}^r  j_k(\gamma ,z ) f(\gamma_j z)
                | where #[m \gamma_j] are coset representatives for
                me \Gamma\backslash \{ x\in \Mat_2(\ZZ) : \det(x) = m\}/\Gamma = \bigsqcup \Gamma \gamma_i
                | and #[m j_k(\gamma z ) = (cz+ d)^{-k}],
                me \gamma = \begin{pmatrix} a \amp b\\ c \amp d\end{pmatrix} \in \SL_2(\ZZ)
                | .
            p
                me h_m(z,z') = \sum_{ad-bc = m }(czz' + dz' + az+ b)^{-k}

            theorem
                title Petersson
                statement: p
                    | Let #[m c_k = \frac{(-1)^{k/2} \pi}{2^{k-3} (k-1)}].
                    ol
                        li
                            | Then #[m c\inv_k m^{k-1} h_m(z,-\bar z')] is the kernel for #[m T_m\acts S_k].

                            | I.e.
                            me c_k\inv m^{k-1 } \int_{\Gamma \backslash \HH} f(z) \overline{h_m(z,-\bar z')} y^k \diff \mu(z)
                            me  = \pair{f}{c_k\inv m^{k-1} h_m(\cdot, -\bar z') }_{\Pet}
                            me = T_m (f) (z')
                            | for all #[m f] cuspidal (so that the integral converges).

                        li
                            me m^{k - 1} c_k\inv h_m(z,z') = \sum_{j=1}^{\dim S_k} \frac{a_j(m)}{\pair{f_j}{f_j}_{\Pet}} f_j(z) f_j(z')
                            | . When #[m \{f_1 ,\ldots, f_{\dim(S_k)}\} ] is a (Hecke normalized)  orthogonal basis for #[m S_k]
                            me f_j(z) = \sum_{n=1}^\infty a_j(n) e(nz)
                            | .
                proof
                    p
                        | For the proof set #[m g_k(z,z') = (z+z')^{-k}].
                        | This implies that
                        me h_m(z,z') = \sum_{\gamma\in \Mat_z(\ZZ),\det(\gamma) =m}  j_k(\gamma; z) g_k(\gamma z ,z')
                        me           = \sum_{\gamma\in \Mat_z(\ZZ),\det(\gamma) =m}  j_k(\begin{pmatrix} 0 \amp 1 \\ 1 \amp 0 \end{pmatrix}^\transpose \gamma\begin{pmatrix} 0 \amp 1 \\ 1 \amp 0 \end{pmatrix}; z) g_k(z, \begin{pmatrix} 0 \amp 1 \\ 1 \amp 0 \end{pmatrix}^\transpose \gamma\begin{pmatrix} 0 \amp 1 \\ 1 \amp 0 \end{pmatrix}z')
                        me           = \sum_{\gamma_1 \in \Mat_2(\ZZ), \det(\gamma_1) =m} j_k (\gamma z;  z') g_k(z;  \gamma_1 z')
                        | which implies that the integral is well defined.
                        ol
                            li
                                | Reduce part 1. to the case of #[m T_1].
                                me T_m(h_1(z, z')) = \sum_{\gamma \in \Gamma} T_m(j_k(\gamma; z) g_k(z; z'))
                                me \sum_{\gamma\in \Gamma} m^{k-1} \sum_{j = 1}^r j_k(\gamma; \gamma_jz) g_k(\gamma\gamma_jz,z') j_k(\gamma_j, z)
                                me \sum_{\gamma\in \Gamma} m^{k-1} \sum_{j = 1}^r j_k(\gamma\gamma_j; z) g_k(\gamma\gamma_jz,z')
                                me m^{k-1} \sum_{\gamma_1 \in \Mat_2(\ZZ), \det(\gamma_1) =m} j_k(\gamma; z) g_k(\gamma z,z') = m^{k-1} h_m(z,z')
                                | .
                                | For #[m h_1] our calculation last time established
                                me c_k\inv \int_{\Gamma\backslash \HH} f(z) \overline{h_1 (z, - \bar z')} y^k \diff \mu(z)  = f(z')
                                | .
                            li
                                | Fix #[m z'].
                                | Implies
                                men#eqn-pet-proof-1 c_k\inv m^{k-1} h_m(z,z')  = \sum_{j=1}^{\dim(S_k)} \frac {\alpha_j (z')}{\pair{f_j}{f_j}_{\Pet}}
                                | by the first part
                                men#eqn-pet-proof-2 c_k\inv m^{k-1} \pair{f_k}{h(\cdot, z')}_\Pet =  T_m(f_k)(z') = a_k(m) f_k(z')
                                | as #[m f_k] is an eigenform.
                                | On the other hand by #[xref(ref="eqn-pet-proof-1")/]
                                me c_k\inv m^{k-1} \pair{f_k}{h_m(\cdot, -\bar z ')} = c_k\inv m^{k-1} \sum_{j=1}^{\dim S_k} \pair{f_k}{\frac{\alpha_j(-\bar z ') f_j}{\pair{f_j}{f_j}_{\Pet}}}_{\Pet}
                                me                                                  = c_k\inv m^{k-1} \sum_{j=1}^{\dim S_k} \frac{\overline{\alpha_j(-\bar z ') f_j}}{\pair{f_j}{f_j}_\Pet} \pair{f_k}{f_j}_\Pet
                                me                                                  = c_k\inv m^{k-1} \sum_{j=1}^{\dim S_k} \overline{\alpha_j(-\bar z ')} \frac{\pair{f_k}{f_k}_{\Pet}}{\pair{f_k}{f_k}_{\Pet}}
                                | combined with #[xref(ref="eqn-pet-proof-2")/] this implies
                                me a_k(m) \overline{f_k(z')} =  c_k\inv m^{k-1}\alpha_k(-\bar z')
                                | Note:
                                me \overline{f_k(z')}=\overline{\sum_{n=1}^\infty a_k(n) e(nz)}
                                me = \sum_{n=1}^\infty a_k(n) \overline{e(nz)}
                                me = \sum_{n=1}^\infty a_k(n) e(-n \overline{z}')
                                | implies
                                me a_k(m) f_k(z')   =  c_k\inv m^{k-1} \alpha_k (z')
                                | so
                                me c_k\inv m^{k-1} h_m(z,z') = \sum_{j=1}^{\dim S_k} \frac{a_j(m)}{\pair{f_j}{f_j}_\Pet} f_j(z)f_j(z')
                                | .
                                // TODO issue here with k


            corollary
                statement: p
                    me c_k\inv m^{k-1} \int_{\Gamma\backslash \HH} h_m( z, - \bar z') y^k \diff \mu(z) = \trace(T(m))

                    | .
                proof: p
                    me \int_{\Gamma\backslash \HH} \sum_{j=1}^{\dim S_k} \frac{a_j(m)}{\pair{f_j}{f_j}_\Pet} f_j(z)\overline{f_j(z)} y^k \diff \mu(z)
                    me = \sum_{j=1}^{\dim(S_k)} a_j(m) \frac{\pair{f_j}{f_j}_\Pet}{\pair{f_j}{f_j}_\Pet}  = \trace(T(m))
                    | .

            p
                | Subtle point (in general):
                | This integral converges, and gives a manageable expression.

    subsection
        title Zagier's approach
        p
            me I(s) = \int_{\Gamma\backslash \HH} h_m(z,-\bar z')  E(z; s) y^k \diff \mu(z)
            | for #[m \Re(s) \gt 1]. (This #[q goes around the convergence issues]).

            | Implies
            me \Res_{s=1 } I(s)  = \trace( T_m) \frac{c_k}{m^{k-1}} E(z; s) = \frac12  \zeta(2s) \pi^s \Gamma(s) \sum_{\gamma \in  \Gamma_\infty \backslash \Gamma} \Im(\gamma z)^s
            | .

        theorem
            statement: p
                ol
                    li
                        | #[m I(s)] is absolutely convergent for #[m \Re(s) \gt 1].
                    li
                        me I(s) = \sum_{\Delta \ne 0} \zeta(s,\Delta) \{\text{archimidean}\}+ \zeta(s,0) \{\text{archimidean}\} +   \frac { (-1)^{k/2}\Gamma(s+ k -1)\zeta(s)\zeta(2s)}{(2\pi)^{s-1}\Gamma(k)}
                        | #[m \zeta(s, \Delta)] is a cousin of #[m \zeta_\Delta(s) = \sum_{I_k} \frac{1}{N(I_k)^s}] for #[m K = \QQ(\sqrt{-\Delta})].

        aside: p Lecture 14 22/3/2018

        paragraphs
            title  Calculation of  #[m I(s)]

            p
                | First step:
            p
                | Recall that there exists a one to one correspondence between (for fixed #[m m,t])
                me \{A \in \Mat_{2\times 2 }(\ZZ) : \trace(A) =  t,\,\det(A)   =m\}
                me \updownarrow
                me  \{\phi(u,v) = au^2 + buv + cv^2 : \Delta_\phi = | \phi| = b^2- 4ac= t^2 - 4m\}
                me \begin{pmatrix}   a\amp b \\ c\amp d \end{pmatrix} \mapsto \phi(u,v) = cu^2 +  (d-a) uv - b^2v^2
                me  \phi(u,v) = au^2 + buv + cv^2 \mapsto \begin{pmatrix}   \frac12 (t-b)\amp -c \\ a\amp \frac12 (t+b)\end{pmatrix}
                |.
                | Using this
                me y^k h_m(z,-\bar z) = \sum_{a,b,c,d\in \ZZ,\,ad-bc = m} \frac{y^k}{(c|z|^2 + d\bar z - az -  b)^k}
                me = \sum_{t\in \ZZ} \sum_{ad-bc = m,\, a+d = t} \frac{y^k}{(c|z|^2 + d\bar z - az -  b)^k}
                me = \sum_{t\in \ZZ} \sum_{\phi,\, |\phi | = t^2 - 4m} R_\phi(z,t)
                | where
                me R_\phi(z,t) = \frac{y^k}{(a|z|^2 + bx + c - ity)^k}
                | .
                | Exercise: substitute #[m a=  \frac 12 (t-b), b=  -c , c = a, d= \frac12 (t+b)].

            proposition
                statement: p
                    | For #[m s\in \CC] s.t. #[m 2-k \lt \Re(s) \lt k- 1]
                    me \sum_{t\in \ZZ}\int_{\Gamma\backslash \HH} |E(z; s)|\left| \sum_{|\phi| = t^2 - 4m } R_\phi(z,t) \right| \diff \mu(z) \lt \infty

            remark
                p
                    | It will turn out that the #[m t]-sum is finite.

            p
                | Recall that #[m \SL_2(\ZZ)] acts on binary quadratic forms #[m \Phi] by
                me \gamma \phi(u,v) = \phi(au + cv, bu + dv)= \phi(\gamma^\transpose \begin{pmatrix}u\\v\end{pmatrix})
                | .

            theorem
                title Geometric side of the Eichler-Selberg trace  formula
                statement
                    p
                        | For #[m t,m] fixed
                        me \int_{\Gamma\backslash\HH} \left( \sum_{|\phi| = t^2 - 4m} R_\phi (z,t)\right) E(z,s) \diff \mu(z) = \zeta(s, \Delta) \left\{I(\Delta, t, s)  + I(\Delta, -t, s)\right\}
                        me + \begin{cases}(-1)^{k/2} \frac{\Gamma(s+ k - 1) \zeta(s) \zeta(2s)}{(2\pi)^{s -1} \Gamma(k)}\amp \Delta = 0 \\ 0 \amp \Delta \ne 0\end{cases}
                        | for #[m \Delta = t^2 - 4m].
                    p
                        | Where
                        me \zeta(s,\Delta)  = \sum_{\phi \pmod \Gamma,\, |\phi| = \Delta} \sum_{(m,n) \in \ZZ^2 \smallsetminus\{(0,0\}/\Aut(\phi),\,\phi(m,n) \gt0} \frac{1}{\phi(m,n)^s}
                        me \Aut(\phi) = \{ \gamma\in \SL_2(\ZZ) : \gamma\phi = \phi\}
                        me I(\Delta, t, s) = \int_0^\infty  \int_{-\infty}^\infty \frac{y^{k+s - 2}}{(x^2 + y^2  +ity -\frac14 \Delta)^k} \diff x \diff y
                        me = \frac{\Gamma(k- \frac 12)\Gamma(\frac 12)}{\Gamma(k)} \int_0^\infty \frac{y^{k+s -2}}{(y^2 + ity - \frac14 \Delta)^{k-\frac 12}} \diff y
                        | .

            remark
                p
                    | If #[m \Delta = \disc(K/\QQ)] then
                    me \zeta(s, \Delta) = \zeta_K(s)
                    | .
                p
                    | Then we have
                    me \sum_t\Res_{s= 1} \zeta_K(s)
                    | where #[m K = \QQ(\sqrt{t^2 - 4m})].
                    // TODO this is not saying anything?
            aside: p Lecture 15 27/3/2018

            proposition
                statement: p
                    | Let #[m \zeta(s, \Delta)] be as above and #[m \Re(s) \gt 1].
                    | Then
                    ol
                        li
                            me \zeta(s, \Delta) = \zeta(2s)\sum_{a = 1}^\infty \frac{n(a)}{a^s}
                            | wn(ae
                            me a(n)  = \#\{b \pmod {2a} : b^2   \equiv \Delta \pmod{4a}\}
                            | .
                        li
                            | #[m \zeta(s, \Delta)] has meromorphic continuation and functional equation.
                            me \gamma(s, \Delta)\zeta(s, \Delta) = \gamma(1-s, \Delta) \zeta(1-s, \Delta)
                            | where
                            me \gamma(s, \Delta) = \begin {cases} (2\pi)^{-s} |\Delta|^{s/2} \Gamma(s)  \amp \Delta\lt 0 \\ \pi^{-s} \Delta^{s/2} \Gamma(s/2)  \amp \Delta \gt 0\end{cases}
                            | .
                        li
                            me \zeta(s, \Delta) = \begin{cases} 0 \amp \Delta\equiv 2,3\pmod4     \\ \zeta(s)\zeta(2s-1)    \amp \Delta = 0\\ \zeta(s) L_D(s) \sum_{d|f } \mu(d)\frac Dd d^{-s} \sigma_{1-2s}(\frac fd)\end{cases}
                            | for #[m D] the fundamental discriminant, so that #[m \Delta = D f^2] and #[m \sigma_\nu (n) = \sum_{d|n} d^\nu], #[m \mu] is the MÃ¶bius function, and #[m L_D(s) = L(s, \legendre{D}{\cdot})].
                        li
                            me \Res_{s=1} \zeta(s, \Delta) = \frac{\pi}{\sqrt{|\Delta|}} H(|\Delta|)
                            | .
                proof
                    p
                        ol
                            li
                                p
                                    | A slick proof involves noting that
                                    me n(a) = \#\{\phi \in \Phi ,\,(m,n) \in \ZZ^2 :  \phi(m,n) = 0, |\phi| = \Delta,\, \gcd(m,n) = 1\}
                                    | comes from the theory of quadratic forms.
                                p
                                    | Instead note that #[m \Gamma \acts \Phi] via #[m \gamma \cdot \phi =(u,v) = \phi(\gamma^\transpose \begin{pmatrix} u\\v \end{pmatrix})].
                                    | We also have #[m \Gamma\acts \ZZ^2] via #[m \gamma \cdot (m,n) = \gamma \begin{pmatrix} m\\n \end{pmatrix}].
                                p
                                    | Note that
                                    me (\gamma ^\transpose)\inv = \begin{pmatrix} 0 \amp 1 \\ -1   \amp 0 \end{pmatrix} \gamma \begin{pmatrix} 0 \amp -1  \\ 1 \amp 0\end{pmatrix}
                                    | (check!).
                                p
                                    | Define
                                    me \pair{-}{-}\colon \Phi \times X
                                    me \pair{\phi}{(m,n)} = \phi(n,-m)
                                    me = \phi \left( \begin{pmatrix} 0 \amp 1 \\ -1  \amp 0 \end{pmatrix} \begin{pmatrix} m \\n \end{pmatrix} \right)
                                    | .
                                p
                                    | Observe #[m \pair{-}{-}] is #[m \Gamma]-invariant!
                                    | i.e.
                                    me \pair{\phi}{(m,n)} = \pair{\gamma \phi }{ \gamma(m,n)}
                                    | for all #[m \gamma \in  \Gamma].
                                    | Then
                                    me \zeta(s, \Delta)  = \sum_{\phi \pmod \Gamma,\, |\phi| = \Delta} \sum_{(m,n) \in X/\Aut(\phi),\,\phi(m,n) \gt 0} \frac{1}{\phi(m,n)^s},\,\Re(s) \gt 1
                                    me                   = \sum_{\phi \in \Phi_\Delta/\Gamma} \sum_{x \in X/\Aut(\phi)} \frac{1}{\pair{\phi}{x}^s}
                                    me                   = \sum_{(\phi,x) \in (\Phi_\Delta \times X)/\Gamma} \frac{1}{\pair{\phi}{x}^s}
                                    men#eqn-zeta-delta-calc                   = \sum_{x\in X/\Gamma} \sum_{\phi\in \Phi_\Delta/\Aut(x)} \frac{1}{\pair{\phi}{x}^s}
                                    | we are using Fubini to swap the order of summation as the pairing is invariant.
                                    | Finally note that
                                    me x= \pm(m,n)\sim_{\Gamma} \pm(0,\gcd(m,n)),\, r = \gcd(m,n) \gt 0
                                    | so #[xref(ref="eqn-zeta-delta-calc")/]
                                    me = \sum_{r= 1}^\infty \sum_{\phi \in \Phi_\Delta/\Aut((r,0))} \frac{1}{\phi(r,0)^s}
                                    | what is #[m \Aut((r,0))]? It is
                                    me \Gamma_\infty^\transpose = \left\{\begin{pmatrix} 1 \amp 0 \\ \ast \amp 1 \end{pmatrix}\right\} \text{ as }\begin{pmatrix} 1 \amp 0 \\ \ast \amp 1 \end{pmatrix}\begin{pmatrix} 0\\ r \end{pmatrix} = \begin{pmatrix} 0\\ r \end{pmatrix}
                                    | continuing we have
                                    me  \zeta(2s) \sum_{a= 1}^\infty  \frac{1}{a^s} \left\{ \sum_{b \pmod{2a},\, b^2 \equiv \Delta \pmod{4a}} 1\right\}
                                    | Exercise, show this is    the sum from before.
                                    | Hint, consider, explicitly, the action of #[m \gamma\in \Gamma_\infty^\transpose] on #[m \phi(u,v)].

            p
                | Back to the proof of the trace formula.

            lemma
                statement: p
                    | Let #[m k \in \ZZ_{\gt 2},\,k\equiv 0 \pmod 2,\,\Delta \in \ZZ,\,\Delta \equiv 0,1 \pmod4,\,t\in \RR] s.t. #[m t^2 \gt \Delta].
                    | For each #[m \phi \in \Phi_\Delta] let
                    me R_\phi (t,z) = \frac{y^k}{(a|z|^2 + bx + c - ity )^k}
                    | Then for #[m s \in \CC], #[m s \ne  1  ], #[m 1-k \lt \Re(s) \lt k].
                    me \int_{\Gamma \backslash \HH} \left(\sum_{|\phi|  = \Delta} R_\phi(t,z)\right) E(z, s) \diff \mu (z)
                    me  = \zeta(s,\Delta) \{I_k(\Delta, t, s) + I_k(\Delta, -t, s)\}
                    me + \begin{cases}(-1)^{k/2} \frac{\Gamma(s+ k - 1) \zeta(s) \zeta(2s)}{(2\pi)^{s -1} \Gamma(k)}\amp \Delta = 0 \\ 0 \amp \Delta \ne 0\end{cases}
                proof: p
                    ol
                        li
                            | Note #[m R_{\gamma\phi}(t,z) = R_\phi (t, \gamma^\transpose z)] which means that the integral is well defined (check this).
                        li
                            me \int_{\Gamma\backslash \HH} \left( \sum_{|\phi| = \Delta} R_\phi (t,z)\right) E(z; s) \diff \mu (z)
                            me = \int_{\Gamma\backslash \HH} \sum_{|\phi| = \Delta} \sum_{(m,n) \in \ZZ^2 \smallsetminus \{(0,0)\}} R_\phi(t, z) \frac{y^s}{|mz+n|^{2s}} \diff \mu(z)
                            | unfold whenever you can!

                        li
                            | Recall #[m \Gamma \acts \Phi_\Delta  \times X] fixing #[m \pair{\phi}{(m,n)} = \phi(m,n)].
                            | We can break the sum into #[m \phi(m,n) \gt 0,\, \phi(m,n) \lt 0].
                        li
                            | Fact: The action of #[m \Gamma] on the above is free, (exercise: prove this fact, hint: first take #[m (m,n) \to (0,r)], and analyse the action of the stabiliser on #[m (0,r)]).
                        li
                            me \int_{\Gamma \backslash \HH} \sum_{|\phi| = \Delta} \sum_{(m,n) \in X,\, \phi(m,n) \gt 0} R_\phi(t,z) \frac{y^s}{|mz+n|^s} \diff \mu(z)
                            me \sum_{(\Phi_\Delta \times X)/\Gamma} \int_\HH R_\phi (t,z) \frac{y^s}{|mz+n|^{2s}} \diff \mu(z)
                            | .
                        li
                            | Check
                            me z\mapsto \frac{nx - \frac 12 bn +cm}{-mz + an - \frac 12 bm}
                            | finishes the proof.
                        li
                            | To check other cases use
                            me R_{-\phi} (z,t) = R_\phi(z,-t)
                            | and
                            me \pair{\phi}{(m,n)} = 0
                            | needs to be considered separately.
            p
                | We really need to check some convergence here, but lets instead use the trace formula for something useful, to determine its value.

        paragraphs
            title Application to spaces of modular forms

            theorem
                statement: p
                    me \left\lfloor \frac{k}{12} \right \rfloor - \mathbf 1[k \equiv 2 \pmod{12}] = -\frac 12 \sum_{t= - 2}^{t = 2} P_k(t,1) H(4-t^2)  - \frac 12
                    | where
                    me H(n) = \text{Hurwitz class number}
                    me P_k(t,m) = \frac{\rho^{k-1} - \bar \rho ^{k-1}}{\rho - \bar \rho},\,\{\rho,\bar \rho\} \text{ solutions to } u^2 - tu + m = 0
                    | then
                    me \dim(S_k(1)) = \left\lfloor \frac{k}{12} \right \rfloor  - \mathbf 1[k \equiv 2 \pmod{12}]
                    | .
                    | This is a weird looking formula but it generalises very well, works even without a complex structure, Riemann-Roch, etc.
                proof
                    p
                        | Recall that
                        me \trace(T_{S_k}(m))
                        | is given by the Eichler-Selberg trace formula.
                        | In particular
                        me \trace(T_{S_k}(m)) = \dim(S_k)
                        me = -\frac 12 \sum_{t^2  -  4 \le 0} P_k(t,1) H(4-t^2)  - \frac 12
                        | we have
                        me H(0) = \frac{-1}{12}
                        me H(3) = \frac{1}{3}
                        me H(4) = \frac{1}{2}
                        | to find the #[m P_k(t,1)]
                        me \rho_t, \bar \rho_t= \frac{t \pm \sqrt{t^2 - 4}}{2} = e^{i\theta}, e^{-i\theta}
                        | so #[m \tan \theta = \frac{\sqrt{4-t^2}}{t}] note then
                        me \frac{\rho_t^{k-1} - \bar \rho_t ^{k-1}}{\rho_t - \bar \rho_t} =  \frac{\rho_{-t}^{k-1} - \bar \rho_{-t} ^{k-1}}{\rho_{-t} - \bar \rho_{-t}} = \frac{\sin((k-1)\theta)}{\sin(\theta)}
                        | so #[m P_k(t,1)] is as in the table
                    table
                        caption Values of #[m P_k(t,1)].
                        tabular
                            row(bottom="major") #[cell: m t] #[cell: m \theta] #[cell: m P_k(t,1)]
                            row #[cell: m 0] #[cell: m \pi/2 ] #[cell: m k\mod 4 - 1]
                            row #[cell: m 1] #[cell: m \pi/3 ] #[cell: m (k\mod 6 - 4)/2)]
                            row #[cell: m 2] #[cell: m 0     ] #[cell: m (k-1)   ]

                    p
                        | Now if #[m k \equiv 0\pmod{12}]
                        me -\left( \frac{-1}{4} - \frac {1}{3} - \frac{k-1}{12}\right) - \frac12 = \frac{k}{12} = \left\lfloor \frac{k}{12}\right \rfloor= \cdots
                        | .

        paragraphs
            title Another application: Equidistribution of Hecke eigenvalues.
            aside: p Lecture 16 29/3/2018

            p
                | Following Serre '97, very readable article.

            p
                | Equidistribution:

            definition
                statement: p
                    | Let #[m (\Omega, \mu)] be a measure space
                    me \Omega\text{ compact}
                    me \mu\text{ positive Radon measure}
                    me \int_\Omega \diff \mu  = 1

            example
                statement: p
                    me [-1,1],\,\frac{\diff x}{2} = \diff \mu

            note
                p
                    | #[m \mu] gives a linear functional.
                    me f\mapsto \int_\Omega f(x) \diff \mu(x)
                    | , notated
                    me \pair{f}{\mu}
                    | .

            definition
                title #[m \delta] measures
                statement
                    p
                        | Let #[m L] be a sequence of indices, going to #[m \infty] (this will be the indexing set for the weight #[m k]).

                        | For #[m \lambda \in L] let #[m I_\lambda] be a  non-empty finite set of cardinality
                        me \#I_\lambda = d_\lambda
                        | (this will be the set of eigenvalues for each #[m k]).
                        | Let
                        me \mathbf X _\lambda = (x_{i,\lambda}),\,i\in I_\lambda
                        | .
                    p
                        | We define
                        me \delta _{\mathbf X_\lambda} = \frac{1}{d_\lambda} \sum_{i\in I_\lambda} \delta_{x_{i,\lambda}}
                        | note
                        me \pair{f}{\delta _{\mathbf X_\lambda}} = \frac{1}{d_\lambda} \sum_{i\in I_\lambda} f(x_{i,\lambda})
                        | .
                    p
                        | The family #[m \mathbf X_\lambda] for #[m \lambda \in L] is called #[m \mu]-equidistributed (or equidistributed with respect to the measure #[m \mu]) if
                        me \lim_{\lambda \to \infty} \delta_{\mathbf X_\lambda} = \mu
                        | the limit is in the weak-#[m \ast] sense i.e.
                        me \lim_{\lambda \to \infty} \pair{f}{\delta_{\mathbf X_\lambda}} = \pair{f}{\mu},\,\forall f \in C(\Omega, \RR)
                        | .

            p
                | So far these are all general statements.
                | Let us put ourselves in the following situation:
            p
                | For each #[m \lambda \in L] we have a linear operator
                me H_\lambda,\,\rank (H_\lambda) = d_\lambda \lt \infty
                | whose eigenvalues are in #[m \Omega].
                | And #[m I_\lambda = \{ 1,2,\ldots, d_\lambda\}], #[m \mathbf X_\lambda = \{x_{1,\lambda}, \ldots, x_{d_\lambda,\lambda}\}] the eigenvalues of #[m H_\lambda] suitably normalised counted with multiplicity.

            proposition
                statement: p
                    | TFAE
                    ol
                        li
                            me \{x_\lambda\}_{\lambda \in L}  \text{ is }\mu \text{ equidistributed on } \Omega
                        li
                            | For all polynomials #[m P] with #[m \RR] coefficients
                            men#eqn-equidist-poly \frac{\trace(P(H_\lambda))}{d_\lambda} \to_{\lambda \to \infty} \pair{P}{\mu}
                        li
                            | For all #[m m \in \ZZ_{\ge 0}] there exists a polynomial #[m P] of degree #[m m] s.t. #[xref(ref="eqn-equidist-poly")/] is satisfied.

                proof: p
                    | Exercise.

            p
                | Now we will choose a special set of polynomials to work with.

            p
                | Symmetric polynomials:
            p
                | Let #[m \Omega= \lb -2 , 2 \rb \leftrightarrow 2 \cos \lb -\pi, \pi\rb = \trace(\specialunitary(2,\CC))], this is really Satake parameters.
                | For #[m x\in \lb -2, 2\rb] we have a corresponding #[m 2\cos (\phi)].
                | Let
                me X_n (x) = e^{in\phi} + e^{i(n-2)\phi} + \cdots + e^{-in\phi} = \trace (\Sym^n(U)),\,x = \trace(u)
                | .
            p
                | Clebesh-Gordon: (Decomposition of tensor powers of irreducible representations of #[m \specialunitary(2, \CC)].
                me X_nX_m = \sum_{0\le r \le \min\{n,m\}} X_{n+m - 2r} = x_{n+m} + x_{n+m-2} +\cdots + x_{|n-m|}
                | .

            exercise
                statement: p
                    | Prove this.

            p
                | Several measures:
                ol
                    li
                        | Sato-Tate:
                        me \mu_\infty = \frac 1 \pi \sqrt{1-\frac{x^2}{4}} \diff x
                        me            = \frac 2 \pi \sin^2(\phi)           \diff \phi
                        | properties
                        me \int_{\Omega} \diff \mu_\infty = 1
                        me \pair{X_n}{ \mu_\infty} = \begin{cases} 1\amp n = 0,\\0\amp\text{otw}\end{cases}
                        me \pair{X_nX_m}{ \mu_\infty} = \delta_{n,m}
                        | .
                        | Exercise: prove this, with orthogonality of characters.
                    li
                        | #[m p]-adic Plancherel measure:

                        | Let #[m q \in \RR_{\gt 1}] and define
                        me f_q(x) = \sum_{n=0}^\infty q^{-n} X_{2n}(x) = \frac{q+1}{(q^{1/2} + q^{-1/2})^2 - x^2}
                        me \mu_q = f_q \mu_\infty
                        | note:
                        me \lim_{q\to 1^+} \mu_q = \frac{\diff \phi}{\pi}
                        me    \lim_{q \to \infty} \mu_q = \mu_\infty
                        | #[m \mu_q] is positive and has total mass 1.
                        | note:
                        me \pair{X_n}{\mu_q} = \pair{X_n}{\sum_{m=0}^\infty q^{-m} X_{2m} \mu_\infty}
                        me                   = \sum_{m=0}^\infty q^{-m} \pair{X_nX_{2m} }{\mu_\infty}
                        me = \begin{cases} q^{-n/2} \amp n\equiv 0 \pmod 2 \\ 0 \amp \text{otw}\end{cases}
                        | .

            theorem
                title Serre '97
                statement: p
                    | #[m k \equiv 0 \pmod 2] let #[m s(k) = \dim(S_k(1))]
                    me T_k'(n) = \frac{T_k(n)}{n^{k-1/2}}
                    | so that the eigenvalues are in  #[m \lb -2, 2\rb] by Deligne.
                    | Letting #[m \mathbf X(k,p)] be the eigenvalues of #[m T_k'(p)].
                    | Then #[m \mathbf X(k,p)] are equidistributed with respect to #[m \mu_p].
                    me \mu_p = \frac{p+1}{(p^{1/2} + p^{-1/2})^2 - x^2} \frac 1 \pi \sqrt{1-\frac{x^2}{4}} \diff x
                    | .
                proof
                    p
                        | Claim:
                        me \lim_{k\to \infty,k\equiv 0 \pmod 2} \frac{\tr(T_k'(n))}{s(k)}
                        me = \lim_{k\to \infty,k\equiv 0 \pmod 2} \frac{\tr(T_k'(n))}{(k-1)/12} = \begin{cases} n^{-1/2} \amp \text{ if } n \text{ is a square}\\ 0 \amp\text{otw}   \end{cases}
                    p
                        | Assume the claim for now:
                        | Note that
                        me T_k'(p^m) = X_m(T_k'(p))
                        | as
                        me \sum_{m=0}^\infty T_k'(p^m)t^m = \frac{1}{1- T_k'(p)t + t^2}
                        me    \sum_{m=0}^\infty X_m(T_k'(p))t^m
                    p
                        me = \lim_{k\to \infty,k\equiv 0 \pmod 2} \frac{\tr(T_k'(n))}{s(k)} = \begin{cases} p^{-m/2} \amp m \equiv 0 \pmod 2\\ 0 \amp\text{otw}   \end{cases}
                        me = \pair{X_m}{\mu_p}
                        | by the claim and previous calculation.
                    p
                        | Proof of the claim:
                        | Recall that the Eichler-Selberg trace formula says that
                        mdn
                            mrow#eqn-serre-equi-1 \tr(T_k(n)) = \frac{k-1}{12} n^{k/2 -1} \delta_{n= \square}
                            mrow#eqn-serre-equi-2 - \frac12 \sum_{t^2 \lt 4n} P_k(t,n) H(4n - t^2)
                            mrow#eqn-serre-equi-3 - \frac 12 \sum_{dd' = n,\,d,d' \gt 0} \min(d,d')^{k-1}
                    p
                        | Sublemma: #[xref(ref="eqn-serre-equi-2")/] #[m = O(n^{k/2})]
                    p
                        | Proof:

                        | #[xref(ref="eqn-serre-equi-2")/] #[m = O_n(\sum_{t^2 \lt 4n} P_k(t,n) )]
                        me P_k(t,n) = \frac{\rho^{k-1} - \bar \rho^{k-1}}{\rho - \bar \rho},\, \rho = \frac{t + i \sqrt{4n - t^2}}{2}
                        me | \rho^{k-1} - \bar \rho^{k-1}| \le 2|\rho^{k-1}| = O((4n- t^2)^{(k-1)/2})
                        me \rho - \bar \rho = \sqrt{n - t^2}
                    p
                        | Sublemma: #[xref(ref="eqn-serre-equi-3")/] #[m = O(n^{(k-1)/2})]
                        | Proof: exercise.
                    p
                        | The equations above combined with  the fact #[m n^{k-1/2} \to n^{-1/2} \delta_{n=\square}].

section#sec-tates-thesis
    title Tate's Thesis (#[m \GL_1] theory)

    introduction
        title What's the aim?
        aside: p Lecture 17 3/4/2018
        p
            | Redo Hecke's work, in an adelic setting, more canonically.
            | I.e. obtain analytic continuation and functional equation of Hecke #[m L]-functions.
            | This was also seemingly a bit more general than the Hecke theory.
            | The local theory will give us terms like
            me (1 - \frac{\chi(p)}{p^r})\inv
            | and the global theory will give
            me \prod_p (1 - \frac{\chi(p)}{p^r})\inv
            | .

    subsection
        title Local theory

        introduction: p
            | For all of today, #[m K] is  a number field and   #[m v] a place of #[m K] so that
            me K_v = \begin{cases} \RR,\CC \amp \text{ if } v \text{ is archimidean} \\ [K_v: \QQ_v] \lt \infty \amp \text{ if } v \text{ is non-archimidean}\end{cases}
            | . If #[m \alpha \in K_v] then
            me |\alpha|_v = \begin{cases} |\alpha|_\CC^2 \amp \text{ if } K_v = \CC \\ |\alpha|_\RR   \amp \text{ if } K_v = \RR \\ N(\varpi_v)^{-v_v(\alpha)} \amp \text{ if } v \text{ is non-archimidean}\end{cases}
            | where #[m |N(\varpi_v) = | \ints_v / \varpi \ints_v|].

        subsubsection
            title Additive theory (Theory of Fourier transform)

            p
                | Let #[m K_v^+] denote the additive group of #[m K_v].

            paragraphs
                title Characters of #[m K_v^+] (continuous)

                lemma
                    statement: p
                        | Let #[m \chi_v] be a non-trivial additive character of #[m K_v^+], i.e.
                        me \chi_v \colon K_v^+ \to \CC^\times
                        | then all the characters of #[m K_v^+] are of the form
                        me \chi_v(\eta \cdot) = \chi_{v,\eta}
                        | for #[m \eta \in K_v^+] i.e.
                        me \chi_{v,\eta}(\xi) = \chi_v(\eta \xi)
                        | which implies
                        me K_v^+  \simeq \widehat K_v^+
                        | both topologically and algebraically.
                    proof: p
                        | Exercise.

            p
                | This is not really canonical, but as far as number theorists are concerned there is a right choice of additive character to fix.

            paragraphs
                title A particular non-trivial additive character

                p
                    | If #[m K_v= \RR,\CC] let
                    me \lambda_0 \colon \RR \to \RR
                    me \xi \mapsto -\xi \pmod 1
                    | then
                    me \chi_v(\xi) = e(\lambda(\xi)) = e^{2\pi  i \lambda(\xi)}
                    | where
                    me \lambda(\xi) = \lambda_0(\tr_{K_v/\RR}(\xi))
                    | .
                p
                    | For #[m K_v] non-archimidean let
                    me \lambda_0 \colon \QQ_v \to \RR
                    me \xi \mapsto \xi \pmod 1
                    | i.e. if
                    me \xi = a_{-N} \varpi_v^{-N} + \cdots + a_{-1}\varpi_v^{-1} \underbrace{+ \cdots}_{\in \ints_v}
                    me \lambda_0 (\xi) = a_{-N} \varpi_v^{-N} + \cdots + a_{-1}\varpi_v^{-1}
                    me \chi_v(\xi) = e(\lambda(\xi))
                    | where
                    me \lambda(\xi) = \lambda_0(\tr_{K_v/\QQ_v}(\xi))
                    | .

                lemma
                    statement: p
                        | Let #[m v] be non-archimidean
                        me \chi_{v,\eta}|_{\ints_v} \equiv 1 \iff \eta\in D_v^{-1}
                        | where #[m D_v] is the different ideal of #[m K_v]
                        me D_v^{-1} = \{x\in K_v : \tr(xy) \in \ZZ_v ,\, \forall y \in \ints_v\}
                        | .

            paragraphs
                title Haar measures

                p
                    ul
                        li
                            | #[m \CC], #[m \mu_v] is 2 times the Lebesgue measure.
                        li
                            | #[m \RR], #[m \mu_v] is the Lebesgue measure.
                        li
                            | #[m K_v], #[m \mu_v(\ints_v) = N(D_v)^{-1/2}].

                lemma
                    statement: p
                        | #[m \alpha \ne 0] implies
                        me \mu_v(\alpha M) = |\alpha|_v \mu(M)
                        | for all measurable sets #[m M].
                    proof: p Exercise

                p
                    | I.e.
                    me \int f(x) \diff \mu(x) = |\alpha|_v \int f(\alpha x) \diff \mu(x)
                    | .

                definition
                    title Fourier Transform
                    statement: p
                        me \hat f(\eta) = \int f(\xi) e(-\lambda_v(\eta\xi)) \diff \mu_v(\xi)
                        | .

                theorem
                    title Fourier inversion
                    statement: p
                        | Let #[m f \in L^1(K_v^+)] such that #[m \hat f \in L^1(K_v^+)], then
                        me f(\xi) = \int \hat f( \eta) e(-\lambda_v(\eta\xi)) \diff \mu(\eta) = \hat{\hat f}(-\xi)
                        | .
                        // TODO check? there was no minus

        subsubsection
            title Multiplicative theory

            definition
                title Unit group
                statement: p
                    me U_v = \ker(x\mapsto |x|_v)
                    | it is compact, open if #[m v] is non-archimidean, e.g.
                    me U_v = \begin{cases}S^1 \amp \text{ if }K_v = \CC \\S^1 \amp \text{ if }K_v = \RR \\ \ints_v^\times \amp\text{ if } v\text{ non-archimidean}\end{cases}
                    | .

            definition#def-quasichar
                statement: p
                    | A #[term quasicharacter] is
                    me K_v^\times \to \CC^\times
                    | A (unitary) character is
                    me K_v^\times \to S^1
                    | .
                    | Such a map is unramified if it is trivial on #[m U_v].
                    | E.g.
                    me \xi \mapsto |\xi|_v^s
                    | is unramified #[m s\in  \CC].

            lemma
                statement: p
                    | All unramified characters are of this form
                    me \widehat K_\nr^\times= \CC/ (2\pi i/ \log(N(\varpi_v)))
                    | if #[m v] is non-archimidean.

            p
                | Choose a uniformiser #[m \varpi_v] s.t.
                me \begin{array}{ccc} \alpha \amp \tilde \alpha \amp \varpi_v^{v_v(\alpha)} \\ \CC^\times \amp S^1 \amp \RR_+ \\ \RR^\times \amp \{\pm 1\}\amp \RR_+ \\ K_v^\times \amp \ints_v^\times \amp \ZZ\end{array}
                | .

            theorem
                statement: p
                    | All quasicharacters of #[m K_v^\times] are of the form
                    me \alpha \mapsto c(\alpha) = \tilde c (\tilde \alpha) |\alpha|^s
                    | where
                    me \tilde c \colon U_v \to \CC^\times
                proof: p
                    | Exercise.

            example
                statement: p
                    | Dirichlet characters mod #[m p].

            p
                | E.g. over #[m \CC^\times] then
                me \tilde c(\alpha) = \left(\frac{\alpha}{|\alpha|}\right)^m,\,m\in \ZZ
                | over #[m \RR^\times] then
                me \tilde c(\alpha) = \left(\frac{\alpha}{|\alpha|}\right)^m,\,m\in \{0,1\}
                | over #[m \ints_v^\times] then
                me \tilde c(\alpha)|_{1+\varpi^k\ints_v} \equiv 1
                | because #[m c] is a continuous map from a #[m p]-adic field to the complex numbers.
                | Let
                me \tilde k = \min\{k\in \NN : \tilde c(\alpha)|_{1+ \varpi_v^k \ints_v} \equiv 1\}
                |  and #[m \varpi_v^{\tilde k} = f_v] is the conductor of #[m \tilde c]

            note
                p
                    | Sometimes this #[m \tilde k] is called the ramification degree of #[m c].

            note: p
                | If #[m c = \tilde c | \cdot |^s] then #[m  \Re(s) = \sigma] is uniquely determined  by #[m c].
                | It is called the exponent of #[m c].
                | In modern lingo this is measuring how non-tempered #[m c] is.

            paragraphs
                title Multiplicative Haar measures

                p
                    | Let
                    me \diff_v^\times \alpha = \begin{cases} \frac{\diff_v \alpha}{|\alpha|_v} \amp \text{ if } v \text{ archimidean}\\ \left(\frac{1}{1-1/N(\varpi_v)}\right) \frac{\diff_v \alpha}{|\alpha|_v}  \amp \text{ if } v \text{ non-archimidean}\end{cases}
                    | where #[m \diff_v \alpha] is the additive Haar measure.
                    | these extra factors are really Tamagawa numbers.
                    | They make the product in the next lemma converge.

                lemma
                    statement: p
                        | For #[m v] non-archimidean
                        me \int_{\ints_v^\times } \diff_v^\times \alpha = N(D_v)^{-1/2}
                        | .
                    proof: p
                        me \int_{\ints_v^\times} \diff_v^\times \alpha= \int_{\ints_v^\times} \frac{\diff_v \alpha}{|\alpha|_v} (1- N(\varpi_v)\inv)\inv
                        me                                            = \int_{\ints_v^\times} \diff_v \alpha (1- N(\varpi_v)\inv)\inv
                        me =  \sum_{\beta \in (\ints_v/\varpi_v\ints_v)^\times} \int _{\beta + \varpi_v\ints_v} \diff_v \alpha(1- N(\varpi_v)\inv)\inv
                        me =  |\varpi_v|_v \sum_{\beta \in (\ints_v/\varpi_v\ints_v)^\times} \int _{\ints_v} \diff_v \alpha(1- N(\varpi_v)\inv)\inv
                        me = N(D_v)^{-1/2} |\varpi_v| (N(\varpi_v) - 1) (1- N(\varpi_v)\inv)\inv = N(D_v)^{-1/2}
                        | .

            aside: p Lecture 18 5/4/2018

            p
                | We are trying to set up a general machinery that will take a  quasicharacter and associate  a zeta function.
                | In fact we want have
                me c\colon N_v^\times \to \CC^\times \leadsto \zeta(f,c)
                | a family of #[m \zeta]-functions.
                | We will then look at the gcd over all possible #[m f], this will be the #[m L]-factor.

        subsubsection
            title Local #[m \zeta]-functions

            p
                | Let
                me f \colon K_v^+ \to \CC
                me \xi \mapsto f(\xi)
                | restrict to
                me f \colon K_v\units \to \CC
                me \alpha \mapsto f(\alpha)
                | and such that
                ol
                    li
                        | #[m f(\xi), \hat f(\xi) \in L^1(K^+)] are continuous.
                    li
                        | #[m f(\alpha) |\alpha|^\sigma] and #[m \hat f (\alpha) |\alpha|^\sigma\in L^1(K\units)] for all #[m \alpha \gt 0].

                | Call the class of such #[m f] #[m S].
            definition
                statement: p
                    | Let #[m f \in S] and #[m c] s.t. exponent of #[m c] is #[m \sigma \gt 0], i.e. #[m c=  c_0 \cdot |\cdot|^s] with #[m c_0] unitary and #[m \Re(s) = \sigma \gt 0] then we may define
                    me \zeta(f,c) = \int_{K_v\units} f(\alpha) c(\alpha) \diff\units \alpha
                    | .


            p
                | In fact we have seen examples of this, for #[m K_v = \RR], the #[m \Gamma] function, in Tate's language this is a local zeta function.
                me \zeta(f, |\cdot |^s) = \int_{\RR\units} e^{-|x|} |x|^s \frac{\diff x}{|x|} = 2 \Gamma(s)

            remark
                p
                    | #[m c = c_0 | \cdot |^s] for fixed #[m f] and #[m c_0]
                    me \implies \zeta(f,c) = \int_{K_v\units} f(\alpha) c_0(\alpha) |\alpha|_v^s\diff \units \alpha
                    | .

            p
                | Aim:
                ol
                    li
                        | Prove that #[m \zeta(f,s)] extends to a meromorphic function of #[m s].
                    li
                        | Calculate this for #[q nice] choices of #[m f].

        subsubsection
            title Analytic properties of #[m \zeta(f,c)]

            lemma
                statement: p
                    | #[m \zeta(f,c)] is a regular function for quasicharacters #[m c] with #[m \sigma \gt 0].
                proof: p
                    me \zeta(f,c) = \int_{K_v\units} f(\alpha) c(\alpha) \diff \units \alpha
                    | check, absolutely convergent around 0, has derivatives around 0, other points are fine.

            lemma
                title fundamental lemma
                statement: p
                    | Let #[m c] be a quasicharacter that satisfies #[m 0 \lt \sigma \lt 1] and define
                    me \hat c (\alpha) = c_0\inv (\alpha) | \cdot| ^{1-s}
                    | then for #[m f,g \in S] we have
                    me \zeta(f,c) \zeta(\hat g,\hat c) =  \zeta(\hat f, \hat c)\zeta(g,c)
                    | .
                proof
                    p
                        | All of the integrals are absolutely convergent.
                    p
                        | Fubini implies the LHS is
                        me \int\int_{(K_v\units)^2} f(\alpha) \hat g(\beta) c(\alpha) c_0\inv(\beta) |\beta|^{1-s} \diff \units \mu(\alpha, \beta)
                        me = \vdots
                        me = \zeta(\hat f, \hat c) \zeta(g ,c)
                        | change variable #[m \beta \mapsto \alpha\beta].
                        // TODO do this, maybe \hat c = c\inv |\cdot| is cleaner?


            theorem
                title Local functional equation
                statement: p
                    | A #[m \zeta]-function will satisfy
                    me \zeta(f,c) = \rho(c) \zeta(\hat f, \hat c)
                    | where #[m \rho] is meromorphic, and is defined initially for #[m 0\lt \sigma \lt 1] then extended by analytic continuation.
                proof: p
                    | Take #[m f= g] so
                    me \rho(C) = \frac{\zeta(f,c)}{\zeta(\hat f, \hat c)}
                    | we will show #[m \rho(c)] is independent of #[m f] and that we can choose #[m f] s.t. #[m \zeta(\hat f, \hat c)] is non-zero.
                    | TBC.

            proposition
                statement: p
                    | Several properties:
                    me \rho(\hat c) = \frac{c(-1)}{\rho(c)}
                    me \rho(\bar c) = c(-1) \overline{\rho(c)}
                    me |\rho(c) | = 1 \text{ if }\sigma= \frac12
                    | .
                proof
                    p
                        me \zeta(f,c) = \rho(c) \zeta(\hat f, \hat c) = \rho(c) \rho(\hat c) \zeta(\hat{\hat f}, \hat{\hat c})
                        | as #[m \hat{\hat c}] and #[m \hat{\hat f}(x) = f(-x)] we get #[m \rho(c) \rho(\hat c) c(-1) \zeta(f,c)].
                    p
                        me \overline{\zeta(f,c)} = \zeta(\bar f, \bar c) = \rho(\bar c) \zeta(\hat{\bar f}, \hat{\bar c})
                        me = \rho(\bar c) c(-1) \overline{\zeta(\hat f, \hat c)}
                        | .
                    p
                        | Remark:
                        me \zeta(\hat{\bar f}, \hat {\bar c}) = \int \hat {\bar f}(\alpha) \hat {\bar c}(\alpha) \diff \units \alpha
                        me = \int\hat {\bar f}(\alpha) \bar c \inv(\alpha) |\alpha| \diff \units \alpha
                        me    = \int \bar {\hat f}(-\alpha) \bar c\inv (\alpha) |\alpha| \diff \units \alpha
                        me = c(-1) \int \bar {\hat f}(\alpha) \bar c\inv(\alpha) |\alpha| \diff \units \alpha
                        me = c(-1)\overline{\zeta(\hat f, \hat c)}
                    p
                        | If #[m \sigma=  \frac12] then #[m c(\alpha) \bar c(\alpha) = |\alpha| = c(\alpha) \hat c(\alpha) = \bar c(\alpha) = \hat c(\alpha)].
                        | Together the previous parts give #[m \rho(c)\overline {\rho(c)} = 1].

        subsubsection
            title Explicit #[m \zeta] functions

            p
                | First let #[m K_v = \RR] then we will use the following notation: Additively #[m \xi] with #[m \Lambda(\xi) = -\xi], #[m \diff \xi] the Lebesgue measure.
                | Multiplicatively #[m \alpha] with #[m |\alpha|_v = |\alpha|_\RR] and #[m \diff \units \alpha = \diff \alpha/|\alpha|_\RR].
                | We will use characters #[m |\cdot |^s] or #[m \mathrm{sgn}|\cdot|^s], #[m f_{|\cdot|^s}= e^{-\pi \xi^2}] and #[m f_{|\cdot|^s\mathrm{sgn}} (\xi) = \xi e^{-\pi \xi^2}].
                | These have fourier transforms
                me \hat f_{|\cdot|^s}(\xi) = f(\xi)
                | and
                me \hat f_{|\cdot|^s\mathrm{sgn}}(\xi) = i f_\mathrm{sgn}(\xi)
                | .
                | So that
                me \zeta(f_{|\cdot|^s}, |\cdot|^s) = \int_{\RR\units} f(\alpha) |\alpha|^s \diff \units \alpha = \int_{\RR\units} e^{-\pi \alpha^2} | \alpha| ^s \diff\units \alpha
                me = 2 \int_0^\infty e^{-\pi \alpha^2}
                me = \pi^{-s/2} \Gamma\left(\frac s2\right)
                | .
                aside: p Lecture 19 10/4/2018
                me \zeta(f_{|\cdot|^s\mathrm{sgn}}, |\cdot|^s\mathrm{sgn}) = \pi^{-(s+1)/2} \Gamma\left(\frac{s+1}{2}\right)
                | now
                me \rho(|\cdot|^s) = 2^{1-s} \pi^{-s} \cos(\pi s /2) \Gamma(s)
                me \rho(|\cdot|^s\mathrm{sgn}) = -i 2^{1-s} \pi^{-s} \sin(\pi s /2) \Gamma(s)
                | . Normalizing by #[m s= 1/2] we get #[m 1 ] and #[m    - i] respectively.

            p
                | Over #[m \CC]
                me.
                    \begin{array}{cc}
                    K_v^+ \amp K_v\units\\
                    \hline
                    \xi = x+iy \amp \alpha = re^{i\theta}\\
                    \Lambda = -2x \amp |\alpha| = r^2\\
                    \diff \xi =2 |\diff x \diff y| \amp \diff\units \alpha =\diff \alpha /|\alpha|=  2|\diff r \diff \theta|/r\\

                    \end{array}
                | characters
                me c \leadsto c_n,\,n\in\ZZ
                me c_n(\alpha) = r^n e^{in \theta}
                | equivalence  class
                me \{c_n(\alpha) |\alpha|^s : s\in \CC \}
                | .
                | Functions
                me f_n(\xi) = \begin{cases} (x-iy)^n e^{-2\pi(x^2 + y^2)} \amp \text{ if } n \ge 0 \\ (x+iy)^{-n} e^{-2\pi(x^2 + y^2)} \amp \text{ if } n \le 0\end{cases}
                me = \begin{cases} r^{|n|}  e^{-in \theta} e^{-2\pi r^2} \amp\text{ if } n \ge 0 \\ r^{|n|} e^{in\theta} e^{-2\pi r^2}\amp \text{ if } n \le 0\end{cases}
                | fourier transforms
            claim
                statement: p: me \hat f_n(\xi) = i^{|n|} f_{-n}(\xi) \,\forall n
                proof
                    p
                        | Induction on #[m n]:
                    p
                        | #[m n = 0]
                        me f_0(\xi) = e^{-\pi (x^2 + y^2)}
                        me \hat f_0(\xi) = 2\int_{\CC} f_0(u+iv) \overbrace{e(2(ux-vy))}^{\Lambda((u+iv)(x+iy))} \diff u \diff v
                        me 2\int_{\RR} e^{-2\pi (u^2 - 2ixu)} \diff u \int_\RR e^{-2\pi(v^2 + 2ivy)} \diff v
                        | which by completing the square and Cauchy gives
                        me e^{-2\pi(x^2 + y^2)} = \hat f_0(\xi)
                    p
                        | Assume #[m \hat f_n(\xi) = i^n f_{-n}(\xi)] for #[m n \gt 0].
                        | Then the induction step is to use #[m \diff / \diff \bar \xi] in the integral defining #[m \hat f_n(\xi)] (exercise).

            p
                me \zeta(f_n, c_n |\cdot|^s) = \int_{\CC\units} f_n(\alpha) c_n(\alpha) |\alpha|^s\diff\units\alpha
                me = 2 \int |r|^n e^{-i n \theta} e^{-2\pi r^2} e^{in \theta} r^{2s-2}
                me = 4\pi \int_0^\infty r^{|n| + 2s - 2} e^{-2 \pi r^2} r \diff r
                me = (2\pi)^{1 - s - |n|/2} \Gamma\left(s+ \frac{|n|}{2}\right)
                | now
                me \zeta(f_{-n}, c_{-n}|\cdot|^s) = i^{|n|} (2\pi)^{s- |n|/2} \Gamma\left(1 - s + \frac{|n|}{2}\right)
                me \rho(c_n|\cdot |^s)  = \frac{(-i)^{|n|} (2 \pi)^{k-s}}{(2\pi)^s} \frac{\Gamma(s + \frac{|n|}{2})}{\Gamma(1-s + \frac{|n|}{2})}
                | .
            p
                | For #[m K] non-archimidean with #[m |\varpi|_v= \frac 1q].
                me.
                    \begin{array}{cc}
                    K^+ \amp K\units\\
                    \hline
                    \xi \amp \alpha = \tilde \alpha \varpi^{v(\alpha)}\\
                    \Lambda (\xi) = \lambda(\tr_{K/\QQ_p}(\xi)) \amp |\alpha| = q_v^{-v(\alpha)}\\
                    \diff \xi \implies \int_\ints \diff \xi = N(D_v)^{-1/2} \amp \diff\units \alpha =(1-q_v\inv)\diff \alpha /|\alpha| \implies \int_{\ints\units} \diff\units \alpha = N(D_v)^{-1/2}
                    \end{array}
                | For #[m D_v] the different ideal.
            p
                | Quasicharacters
                me c_n \colon \ints\units \to \CC\units
                | of conductor #[m f (\varpi^n)\ints_v]. #[m c_n(\varpi) = 1].
                | Equivalence class of #[m c_n]
                me \{c_n |\cdot|^s : s\in \CC\}
                |.
            p
                | Functions
                me f_n(\xi) = \begin{cases} e(\Lambda(\xi)) = e^{2\pi i \lambda(\tr(\xi))} \amp \text{ if } \xi\in D_v\inv \varpi^{-n} \\ 0 \amp\end{cases}
                | .
            p
                | The fourier transforms

            lemma
                statement: p
                    me \hat f_n(\xi) = \begin{cases} |D_v|^{-1/2} |\varpi_v|^{-n} \amp \text{ if } \xi \equiv 1 \pmod{\varpi^n} \\ 0 \amp \end{cases}
                proof: p
                    me \hat f_n(\xi) = \int_K f_n(\eta) e(-\Lambda (\eta \xi)) \diff \eta
                    me =\int_{D_v\inv \varpi^{-n} \ints_v} e(\Lambda(\eta(1-\xi))) \diff \eta
                    me = \begin{cases} 0 \amp \text{ if } \xi \ne 1 \pmod{\varpi^n} \\ |D_v|\inv |\varpi|^{-n} \int_{\ints_v} \diff \eta \amp   \end{cases}
                    me = \begin{cases} 0 \amp \text{ if } \xi \ne 1 \pmod{\varpi^n} \\ |D_v|^{-1/2} |\varpi|^{-n} \amp   \end{cases}
                    // ????

            p
                | Unramified calculation:
                me \zeta(f_0, |\cdot |^s)  =  \int_{K\units} f_0(\alpha) |\alpha|^s \diff\units \alpha
                me  = \int_{D_v\inv} e(\Lambda(\alpha) ) |\alpha| ^s \diff\units \alpha
                me  = \int_{D_v\inv} |\alpha|^s \diff\units \alpha
                me  = \sum_{k=0}^\infty|D_v|^{-s} \int_{\varpi^n \ints\units}|\alpha|^s \diff\units \alpha
                me \left(\ints =  \bigsqcup_{n=0}^\infty \varpi^n \ints\units_v\right)
                me = \sum_{k=0}^\infty |D_v|^{-s+1/2} q_v^{-ns}
                me  = |D_v|^{-s+1/2} \frac{1}{1-1/q_v^s}
                me \zeta(\hat f_0, |\cdot |^{1-s}) = \zeta(|D_v|^{-1/2} \mathbf 1_{\ints_v}, |\cdot |^{1-s})
                me = N(D_v)^{1/2} \int_{\ints_v} |\alpha|^{1-s} \diff\units \alpha
                me  =  \frac{1}{1-1/q_v^{1-s}}


            p
                | Let's recap a little, we have #[m K\units \hookrightarrow K^+] and moreover #[m K\units \acts K^+] with two orbits #[m   \{0\}] and the rest.
                | Looking at function spaces we have
                me \cinf_c(K\units) \hookrightarrow S(K^+)
                | , Schwartz functions on the right.
                | Taking duals to get spaces of distributions
                me 1 \to  ?? \to D(K^+)_c \to \cinf_c (K\units)^\vee_c \to 0
                | .
            corollary
                statement: p
                    | There is #[m \rho(c)] s.t.
                    me \zeta(f,c) = \rho(c) \zeta(\hat f, \hat c)
                    | with
                    me \rho(c) = \frac{\zeta(f,c)}{\zeta(\hat f, \hat c)}
                    | .

            aside: p Lecture 20 12/4/2018

            p
                | We have done the case of unramified characters.
            p
                | Case II:
                | #[m n \gt 0]
                me \zeta(f_n, c_n|\cdot|^s) = \int_{K_v\units} f_n(\alpha) c_n(\alpha) |\alpha|^s \diff\units \alpha
                me = \int_{(D_vf_v) \inv} e(\Lambda(\alpha))(c(\alpha)) |\alpha|_v^s \diff \units \alpha
                | .
                | Let
                me (D_v) = (\varpi_v^d)
                me f= (\varpi_v^n)
                me = int_{(\varpi_v^{n+d})\inv} e(\Lambda(\alpha)) c_n(\alpha) |\alpha|^s \diff \units \alpha
                me = \sum_{j = -n-d}^\infty \int_{\varpi_v^j \ints_v\units } e(\Lambda(\alpha)) c_n(\alpha) |\alpha|^s \diff \units \alpha
                | let #[m \alpha = \varpi_v^j \alpha] which implies
                me = \sum_{j = -n-d}^\infty q_v^{js}\int_{\ints_v\units } e(\Lambda(\varpi^j\alpha)) c_n(\alpha) |\alpha|^s \diff \units \alpha
                | .

            lemma
                statement: p
                    | If #[m j \ge -d] then
                    me \int_{\ints_v\units} (\Lambda(\varpi_v^j \alpha)) c_n(\alpha) \diff\units \alpha = 0
                    | .
                proof: p
                    | #[m j \ge -d] implies
                    me \varpi_v^j \ints_v\units \subseteq D_v\inv
                    me \implies \Lambda(\varpi_v^j \ints_v\units) \subseteq\ZZ
                    me \implies e(\Lambda(\varpi_v^j \ints_v\units)) = 1
                    | so the integral in question
                    me  = \int_{\ints_v\units} c_n(\alpha) \diff\units \alpha
                    | as #[m c_n \ne 1].

            p
                | So finitely many are non-zero.

            lemma
                statement: p
                    | #[m - n - d \lt j \lt -d] then
                    me \int_{\ints_v\units} e(\Lambda(\varpi_v^j \alpha)) c_n(\alpha) \diff \units \alpha = 0
                    | .
                proof: p
                    | (Note #[m -n-d \lt j \lt -d \iff 0 \lt -j-d \lt n])
                    | Let #[m \alpha = a (1 + \varpi_v^{-d-j} \alpha_1)].
                    | So we may write
                    me \sum_{a \mod{\units \varpi_v^{d+j}}}  \int_{\ints_v} e(\Lambda(\varpi_v^ja (1+ \varpi_v^{-d-j} \alpha_1))) c_n(a (1+ \varpi_v^{-d-j} \alpha_1)) \diff \units \alpha
                    | .
                    | (Note: #[m \varpi_v^j (a(1+ \varpi_v^{-j-d} \alpha_1)) = a\varpi_v^j + a \varpi_v^{-d} \alpha_1], the last term is in #[m D_v\inv] so #[m e(\Lambda(\varpi_v^ja (1+ \varpi_v^{-d-j} \alpha_1))) = e(\Lambda(\varpi_v^ja))])
                    | So the integral is
                    me \sum_{a \mod{\units \varpi_v^{d+j}}} c_n(a) e(\Lambda(\varpi_v^ja)) \int_{\ints_v} c_n(1+ \varpi_v^{-d-j} \alpha_1) \diff \units \alpha = 0
                    | as we are integrating over a multiplicative group.

            p
                | Therefore: In the ramified case we have
                me \zeta(f_b, |\cdot |^s c_n) = e_v^{(n+d) s} \int_{\ints_v\units} e(\Lambda(\varpi_v^{-(n+d)} \alpha)) c_n(\alpha) \diff \units \alpha
                me = q_v^{(n+d)s} \sum_{a \mod{\units \varpi_v^{ n }}} e(\Lambda(\varpi_v^{-(n+d)} a)) c_n(a) \int_{1 + \varpi_v^n \ints_v} \diff \units \alpha
                | .
                me N(D_v f_v)^s A_n G(c_n)
                | where
                me G(c_n) = \sum_{a \mod{\units \varpi_v^{ n }}} e(\Lambda(a\varpi^{-d-n})) c_n(a)
                | is a Gauss-sum for #[m c_n], with #[m |G(c_n)| = N(f)^{1/2}].

            corollary
                statement: p
                    me \zeta(\hat f, c_n\inv |\cdot |^{1-s}) = N(D_v)^{1/2} N(f_v) A_n
                    | .
                proof: p
                    | Exercise.

            p
                | This finishes the proof of the local functional equation.
                me \zeta(f,c) = \int_{K_v\units} f(\alpha) c(\alpha)\diff \units \alpha
                | .
            p
                | A little bit of a more modern approach that may be helpful if you want to read things since Tate.
                me \psi_v \text{ additive character}
                me \mu \text{ additive measure, self-dual w.r.t } \psi_v

            definition
                statement: p
                    | A family of #[m \zeta]-integrals for each #[m |cdot |^s \chi_v]
                    me \chi_v \colon K_v\units \to \CC \units
                    | .
                    me Z(s,\chi_v, f_v, \psi_v) = \int_{K_v\units} f(\alpha) \chi_v(\alpha) |\alpha|^s \diff \units \alpha
                    me Z \colon \mathcal S(K_v\units) \to \CC
                    | .

            remark
                p
                    | The interesting part of this integral is when #[m \alpha] is close to 0.
            p
                | To study this around 0
                me f(\alpha) = a\phi_1( \alpha) + \phi_2(\alpha)
                | where #[m \phi_1] is the characteristic function of a very small (depending on #[m f]) neighbourhood of 0.
                | #[m \phi_2] is 0 around a sufficiently small neighbourhood of 0.

            p
                me Z(s, \chi_v, \phi_2, \psi_v) = \int_{K_v\units} \phi_2(\alpha) \chi_v(\alpha) |\alpha|_v^s  \diff\units \alpha
                me = \sum_{j = -N_1}^{N_2} c_j \int_{\varpi_v^j \ints_v\units} \chi_v(\alpha) |\alpha|^s \diff\units \alpha
                | This converges for all #[m s \in \CC] and lands in #[m \CC\lb q_v^s, q_v^{-1}\rb]
                | .
            p
                me Z(s, \chi_v, \phi_1, \psi_v) = \sum_{j = M  }^\infty    \int_{\varpi_v^j \ints_v\units} \chi_v(\alpha) |\alpha|^s \diff\units \alpha
                me = \sum_{j = M  }^\infty  | \varpi_v^j|^s  \int_{\ints_v\units} \chi_v(\varpi_v^j\alpha) \diff\units \alpha
                | this is a multiple of
                me \begin{cases} 0 \amp \text{ if } \chi_v \text{ is ram.} \\ \frac{1}{1 - 1 /q_v^s} \amp \text{ if } \chi_v \text{ unram.}\end{cases}
                | .

            p
                | Usually these observations are packed into saying
                me Z(s,\chi_v, f)
                | is
                ol
                    li
                        | Rational function of #[m q_v^s] and in #[m \CC\lb q_v^s, q_v^{-s}\rb].
                    li
                        | #[m \chi_v] is unramified if its entire.
                    li
                        | There exists #[m f\in \mathcal S(K)] s.t.
                        me Z(s,\chi, f) = L(s, \chi)
                        |.
                    li
                        | For all #[m f]
                        me \frac{Z(s, \chi, f)}{L(s, \chi, f)}
                        | is entire.
                | It is then said that #[m L(s,\chi)] is the GCD of the #[m \zeta] integrals #[m Z(s, \chi, f)].

            p
                me.
                    \begin{array}{c|c|c}
                    \text{Field} \amp \chi_v \amp L_v(s, \chi_v)\\
                    \hline
                    \CC       \amp |\cdot|^s_\CC\chi_n \amp 2(2\pi)^{-(s+ |n|/2)} \Gamma(s + |n|/2)\\
                    \RR       \amp |\cdot|^s_\RR               \amp (\pi)^{-s/2)} \Gamma(s/2)\\
                    \RR       \amp |\cdot|^s_\RR\mathrm{sgn}   \amp \pi^{-(s+1)/2)} \Gamma((s+1)/2)\\
                    K_v       \amp |\cdot|^s \chi_v \text{ ur} \amp (1- \chi_v( \varpi_v)/q_v^s)\inv\\
                    K_v       \amp |\cdot|^s \chi_v \text{ ram}\amp 1\\
                    \end{array}
